(()=>{function Pe(v,E,T){let M;return function(){let _=this,S=arguments,B=function(){M=null,T||v.apply(_,S)},x=T&&!M;clearTimeout(M),M=setTimeout(B,E),x&&v.apply(_,S)}}function Te(){console.log("Configurando funcionalidades globais...");let v=document.getElementById("template-painel-feedback"),E=document.getElementById("feedback-placeholder-desktop"),T=document.getElementById("feedback-placeholder-mobile"),M=document.getElementById("mobileMenuButton");if(v&&E&&T){let u=()=>(E.innerHTML="",T.innerHTML="",v.content.cloneNode(!0)),m=()=>{let f=u();window.innerWidth>=992?E.appendChild(f):T.appendChild(f)};m(),window.addEventListener("resize",Pe(m,200))}if(M){let u=document.querySelectorAll(".offcanvas"),m=M.closest(".dropdown");u.forEach(f=>{f.addEventListener("show.bs.offcanvas",()=>{m&&(m.style.zIndex="1040")}),f.addEventListener("hidden.bs.offcanvas",()=>{m&&(m.style.zIndex="")})})}function _(){window.scrollTo({top:0,behavior:"smooth"})}let S=document.getElementById("btnVoltarAoTopo");S&&(S.addEventListener("click",_),window.onscroll=function(){document.body.scrollTop>100||document.documentElement.scrollTop>100?S.classList.add("show"):S.classList.remove("show")});let B="radarPncpCookieConsent",x=document.getElementById("cookieConsentBanner"),C=document.getElementById("btnAceitarCookies");!localStorage.getItem(B)&&x&&setTimeout(()=>x.classList.add("show"),500),C&&C.addEventListener("click",()=>{localStorage.setItem(B,JSON.stringify({accepted:!0,timestamp:new Date().toISOString()})),x&&x.classList.remove("show")});function k(){let u=document.getElementById("logoDesktop"),m=document.getElementById("logoBuscaLicitacoes"),f=document.getElementById("logoMobile"),y=document.getElementById("logoBuscaLicitacoesMobile");!u||!m||!f||!y||(document.body.classList.contains("page-busca-licitacoes")?(u.style.display="none",m.style.display="inline-block",f.style.display="none",y.style.display="inline-block"):(u.style.display="inline-block",m.style.display="none",f.style.display="inline-block",y.style.display="none"))}if(k(),document.body.classList.contains("page-home")){let y=function(){u.forEach(P=>P.classList.remove("active")),this.classList.add("active")},G=function(){let P=this.classList.contains("active");u.forEach(I=>I.classList.remove("active")),P||this.classList.add("active")};console.log("L\xF3gica da Home Page (acorde\xE3o) iniciada.");let u=document.querySelectorAll(".accordion-card"),m=()=>window.innerWidth<=767,f=()=>{u.forEach(P=>{P.removeEventListener("mouseover",y),P.removeEventListener("click",G)}),m()?u.forEach(P=>P.addEventListener("click",G)):u.forEach(P=>P.addEventListener("mouseover",y))};f(),window.addEventListener("resize",Pe(f,250))}}var se="radarPncpFavoritos";function X(){let v=localStorage.getItem(se);try{return v?JSON.parse(v):[]}catch(E){return console.error("Erro ao parsear favoritos do localStorage:",E),localStorage.removeItem(se),[]}}function Be(v){if(!v)return!1;let E=X();return E.includes(v)?!1:(E.push(v),localStorage.setItem(se,JSON.stringify(E)),console.log("Adicionado aos favoritos:",v),!0)}function ge(v){if(!v)return!1;let E=X(),T=E.indexOf(v);return T>-1?(E.splice(T,1),localStorage.setItem(se,JSON.stringify(E)),console.log("Removido dos favoritos:",v),!0):!1}function ee(v){return v?X().includes(v):!1}function ve(){console.log("P\xE1gina de busca de licita\xE7\xF5es detectada. Inicializando funcionalidades...");let v=document.getElementById("filtrosAtivosContainer"),E=document.getElementById("filtrosAtivosTexto"),T=document.getElementById("linkLimparFiltrosRapido"),M=document.getElementById("ufsContainerDropdown"),_=document.getElementById("municipiosHelp"),S=document.getElementById("modalidadesContainerDropdown"),B=document.getElementById("statusContainer"),x=document.getElementById("statusWarning"),C=document.getElementById("dataPubInicio"),k=document.getElementById("dataPubFim"),u=document.getElementById("dataAtualizacaoInicio"),m=document.getElementById("dataAtualizacaoFim"),f=document.getElementById("valorMin"),y=document.getElementById("valorMax"),G=document.getElementById("btnBuscarLicitacoes"),P=document.getElementById("btnLimparFiltros"),I=document.getElementById("licitacoesTableBody"),A=document.getElementById("paginationControls"),J=document.getElementById("totalRegistrosInfo"),R=document.getElementById("exibicaoInfo"),O=document.getElementById("ordenarPor"),V=document.getElementById("itensPorPagina"),le=document.getElementById("palavraChaveInclusaoInput"),K=document.getElementById("tagsPalavraInclusaoContainer"),re=document.getElementById("palavraChaveExclusaoInput"),Z=document.getElementById("tagsPalavraExclusaoContainer"),q=document.getElementById("loadingOverlay"),ze=document.getElementById("lista-favoritos-sidebar"),ce=document.getElementById("detailsPanel"),de=document.getElementById("offcanvasFiltrosBody"),b=[],L=[],F=1,he={},Ae=[{sigla:"AC",nome:"Acre"},{sigla:"AL",nome:"Alagoas"},{sigla:"AP",nome:"Amap\xE1"},{sigla:"AM",nome:"Amazonas"},{sigla:"BA",nome:"Bahia"},{sigla:"CE",nome:"Cear\xE1"},{sigla:"DF",nome:"Distrito Federal"},{sigla:"ES",nome:"Esp\xEDrito Santo"},{sigla:"GO",nome:"Goi\xE1s"},{sigla:"MA",nome:"Maranh\xE3o"},{sigla:"MT",nome:"Mato Grosso"},{sigla:"MS",nome:"Mato Grosso do Sul"},{sigla:"MG",nome:"Minas Gerais"},{sigla:"PA",nome:"Par\xE1"},{sigla:"PB",nome:"Para\xEDba"},{sigla:"PR",nome:"Paran\xE1"},{sigla:"PE",nome:"Pernambuco"},{sigla:"PI",nome:"Piau\xED"},{sigla:"RJ",nome:"Rio de Janeiro"},{sigla:"RN",nome:"Rio Grande do Norte"},{sigla:"RS",nome:"Rio Grande do Sul"},{sigla:"RO",nome:"Rond\xF4nia"},{sigla:"RR",nome:"Roraima"},{sigla:"SC",nome:"Santa Catarina"},{sigla:"SP",nome:"S\xE3o Paulo"},{sigla:"SE",nome:"Sergipe"},{sigla:"TO",nome:"Tocantins"}],ae="radarPncpUltimosFiltros",W="radarPncpCollapseState",be=a=>{if(!a)return"N/I";try{let e=new Date(a);if(isNaN(e.getTime())){let t=new Date(a+"Z");return isNaN(t.getTime())?(console.warn("Data/hora inv\xE1lida recebida:",a),"Data/Hora Inv\xE1lida"):t.toLocaleString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}return e.toLocaleString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Erro ao formatar data e hora:",a,e),"Data/Hora Inv\xE1lida"}};T&&T.addEventListener("click",function(a){a.preventDefault(),Se()});let Ee=document.getElementById("btnExportarCsv");Ee&&Ee.addEventListener("click",function(){let a=new URLSearchParams;b.length>0&&b.forEach(n=>a.append("palavraChave",n)),L.length>0&&L.forEach(n=>a.append("excluirPalavra",n)),document.querySelectorAll(".filter-uf:checked").forEach(n=>a.append("uf",n.value)),document.querySelectorAll(".filter-modalidade:checked").forEach(n=>a.append("modalidadeId",n.value));let e=document.querySelector(".filter-status:checked");e&&a.append("statusRadar",e.value),document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked").forEach(n=>a.append("municipioNome",n.value)),C.value&&a.append("dataPubInicio",C.value),k.value&&a.append("dataPubFim",k.value),u.value&&a.append("dataAtualizacaoInicio",u.value),m.value&&a.append("dataAtualizacaoFim",m.value),f.value&&a.append("valorMin",f.value),y.value&&a.append("valorMax",y.value);let[t,o]=O.value.split("_");a.append("orderBy",t),a.append("orderDir",o.toUpperCase()),console.log("Exportando com os seguintes par\xE2metros:",a.toString());let i=`/api/exportar-csv?${a.toString()}`;window.open(i,"_blank")}),de&&(de.addEventListener("keydown",function(a){if((a.key==="Enter"||a.key==="NumpadEnter")&&(a.ctrlKey||a.metaKey)){console.log("Ctrl+Enter pressionado, aplicando filtros..."),a.preventDefault(),w(1);let e=document.getElementById("offcanvasFiltros");if(e){let t=bootstrap.Offcanvas.getInstance(e);t&&t.hide()}}}),de.addEventListener("click",function(a){if(a.target.classList.contains("btn-limpar-grupo")){let e=a.target.dataset.limpar;console.log(`[DEBUG] \u{1F5B1}\uFE0F Clique no 'X' do GRUPO '${e}'`);let t=!1;switch(e){case"status":let o=document.querySelector('.filter-status[value="A Receber/Recebendo Proposta"]');o&&(o.checked=!0);break;case"modalidades":document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked").forEach(i=>i.checked=!1),j();break;case"inclusao":b.length>0&&(b=[],N(b,K,"inclusao"),t=!0);break;case"exclusao":L.length>0&&(L=[],N(L,Z,"exclusao"),t=!0);break;case"localizacao":document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked").forEach(i=>i.checked=!1),ie();break;case"avancado":C&&(C.value=""),k&&(k.value=""),u&&(u.value=""),m&&(m.value=""),f&&(f.value=""),y&&(y.value="");break}t&&Y(!0)}}));function N(a,e,t){console.log(`[DEBUG] \u{1F3A8} RENDERIZANDO TAGS para '${t}'. Dados:`,JSON.stringify(a)),e&&(e.innerHTML="",a.forEach((o,i)=>{let n=document.createElement("span");n.classList.add("tag-item"),n.textContent=o;let s=document.createElement("button");s.classList.add("remove-tag"),s.innerHTML="\xD7",s.title="Remover palavra",s.type="button",s.addEventListener("click",()=>{t==="inclusao"?(b.splice(i,1),N(b,K,"inclusao")):t==="exclusao"&&(L.splice(i,1),N(L,Z,"exclusao")),Y()}),n.appendChild(s),e.appendChild(n)}))}function te(a,e,t,o){if(console.log(`[DEBUG] \u{1F4E5} Adicionando palavra-chave para '${o}'...`),!a)return;let i=a.value.trim();if(i){let n=i.split(/[,;]+/).map(r=>r.trim()).filter(r=>r!==""&&r.length>0),s=!1;n.forEach(r=>{e.includes(r)||(e.push(r),s=!0)}),a.value="",s&&(N(e,t,o),Y())}}function ye(a,e,t){a&&(a.addEventListener("keyup",function(o){(o.key==="Enter"||o.key==="NumpadEnter"||o.keyCode===13)&&(o.preventDefault(),t==="inclusao"?te(a,b,e,t):t==="exclusao"&&te(a,L,e,t))}),a.addEventListener("input",function(o){let i=a.value;(i.endsWith(",")||i.endsWith(";"))&&(a.value=i.slice(0,-1),t==="inclusao"?te(a,b,e,t):t==="exclusao"&&te(a,L,e,t))}))}function Le(){if(!v||!E)return;let a=[];b.length>0&&a.push(`Buscar: ${b.map(n=>`<span class="badge bg-primary">${n}</span>`).join(" ")}`),L.length>0&&a.push(`Excluir: ${L.map(n=>`<span class="badge bg-danger">${n}</span>`).join(" ")}`);let e=Array.from(document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked")).map(n=>n.value);e.length>0&&a.push(`UF: ${e.map(n=>`<span class="badge bg-secondary">${n}</span>`).join(" ")}`);let t=Array.from(document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked")).map(n=>n.value);t.length>0&&a.push(`Munic\xEDpio: ${t.map(n=>`<span class="badge bg-info text-dark">${n}</span>`).join(" ")}`);let o=Array.from(document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked")).map(n=>{let s=document.querySelector(`label[for="${n.id}"]`);return s?s.textContent:n.value});o.length>0&&a.push(`Modalidade: ${o.map(n=>`<span class="badge bg-warning text-dark">${n}</span>`).join(" ")}`);let i=document.querySelector(".filter-status:checked");if(i&&i.value){let n=document.querySelector(`label[for="${i.id}"]`);a.push(`Status: <span class="badge bg-success">${n?n.textContent:i.value}</span>`)}else i&&i.value===""&&a.push('Status: <span class="badge bg-dark">Todos</span>');if(C.value||k.value){let n="Data Pub.: ";C.value&&(n+=`de ${new Date(C.value+"T00:00:00").toLocaleDateString("pt-BR")} `),k.value&&(n+=`at\xE9 ${new Date(k.value+"T00:00:00").toLocaleDateString("pt-BR")}`),a.push(`<span class="badge bg-light text-dark border">${n.trim()}</span>`)}if(u&&m&&(u.value||m.value)){let n="Data Atual.: ";u.value&&(n+=`de ${new Date(u.value+"T00:00:00").toLocaleDateString("pt-BR")} `),m.value&&(n+=`at\xE9 ${new Date(m.value+"T00:00:00").toLocaleDateString("pt-BR")}`),a.push(`<span class="badge bg-light text-dark border">${n.trim()}</span>`)}if(f.value||y.value){let n="Valor: ";f.value&&(n+=`min R$ ${f.value} `),y.value&&(n+=`max R$ ${y.value}`),a.push(`<span class="badge bg-light text-dark border">${n.trim()}</span>`)}a.length>0?(E.innerHTML=a.join(" \u2022 "),v.style.display="block"):E.innerHTML="Nenhum filtro aplicado."}function oe(){let a=document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked").length,e=document.getElementById("ufSelectedCount");e&&(e.textContent=a,e.style.display=a>0?"":"none")}function j(){let a=document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked").length,e=document.getElementById("modalidadesSelectedCount");e&&(e.textContent=a,e.style.display=a>0?"inline-block":"none")}function ne(){let a=document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked").length,e=document.getElementById("municipiosSelectedCount");e&&(e.textContent=a,e.style.display=a>0?"inline-block":"none",a===0&&(e.textContent="0"))}function ue(a,e,t){let o=document.getElementById(a),i=document.getElementById(e);!o||!i||(o.addEventListener("input",function(){let n=o.value.toLowerCase();i.querySelectorAll(t).forEach(r=>{let l=r.querySelector("label");l&&(l.textContent.toLowerCase().includes(n)?r.style.display="block":r.style.display="none")})}),i.addEventListener("click",function(n){n.target.matches(".form-check-input")&&(o.value="",i.querySelectorAll(t).forEach(r=>{r.style.display="block"}))}))}function Y(){console.log("[DEBUG] \u{1F4BE} SALVANDO FILTROS no localStorage...");let a={palavrasChaveInclusao:b,palavrasChaveExclusao:L,status:document.querySelector(".filter-status:checked")?.value||"A Receber/Recebendo Proposta",ufs:Array.from(document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked")).map(e=>e.value),municipios:Array.from(document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked")).map(e=>e.value),modalidades:Array.from(document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked")).map(e=>e.value),dataPubInicio:C.value,dataPubFim:k.value,dataAtualizacaoInicio:u.value,dataAtualizacaoFim:m.value,valorMin:f.value,valorMax:y.value,ordenacao:O.value,itensPorPagina:V.value};localStorage.setItem(ae,JSON.stringify(a)),console.log("[DEBUG] \u2705 Filtros salvos. Estado atual:",{inclusao:b,exclusao:L}),console.log("[DEBUG] localStorage agora cont\xE9m:",localStorage.getItem(ae))}function Me(){console.log("[DEBUG] \u{1F504} CARREGANDO FILTROS do localStorage...");let a=localStorage.getItem(ae);if(!a){console.log("Nenhum filtro salvo encontrado.");return}try{let e=JSON.parse(a);if(console.log("Carregando filtros salvos:",e),e.palavrasChaveInclusao&&(b=e.palavrasChaveInclusao,N(b,K,"inclusao")),e.palavrasChaveExclusao&&(L=e.palavrasChaveExclusao,N(L,Z,"exclusao")),e.status){let t=document.querySelector(`.filter-status[value="${e.status}"]`);t&&(t.checked=!0)}e.ufs&&e.ufs.length>0&&(e.ufs.forEach(t=>{let o=document.querySelector(`#ufsContainerDropdown .filter-uf[value="${t}"]`);o&&(o.checked=!0)}),ie().then(()=>{e.municipios&&e.municipios.length>0&&(e.municipios.forEach(t=>{let o=document.querySelector(`#municipiosContainerDropdown .filter-municipio[value="${t}"]`);o&&(o.checked=!0)}),ne())})),e.modalidades&&e.modalidades.length>0&&(e.modalidades.forEach(t=>{let o=document.querySelector(`#modalidadesContainerDropdown .filter-modalidade[value="${t}"]`);o&&(o.checked=!0)}),j()),e.dataPubInicio&&(C.value=e.dataPubInicio),e.dataPubFim&&(k.value=e.dataPubFim),e.dataAtualizacaoInicio&&(u.value=e.dataAtualizacaoInicio),e.dataAtualizacaoFim&&(m.value=e.dataAtualizacaoFim),e.valorMin&&(f.value=e.valorMin),e.valorMax&&(y.value=e.valorMax),e.ordenacao&&(O.value=e.ordenacao),e.itensPorPagina&&(V.value=e.itensPorPagina)}catch(e){console.error("[DEBUG] \u274C Erro ao carregar/parsear filtros:",e),localStorage.removeItem(ae)}}document.querySelectorAll(".filter-collapsible .collapse").forEach(a=>{a.addEventListener("shown.bs.collapse",e=>{let t=JSON.parse(localStorage.getItem(W)||"{}");t[e.target.id]=!0,localStorage.setItem(W,JSON.stringify(t))}),a.addEventListener("hidden.bs.collapse",e=>{let t=JSON.parse(localStorage.getItem(W)||"{}");t[e.target.id]=!1,localStorage.setItem(W,JSON.stringify(t))})});function Ge(){let a=JSON.parse(localStorage.getItem(W)||"{}");for(let e in a)if(a[e]){let t=document.getElementById(e);t&&new bootstrap.Collapse(t,{toggle:!1}).show()}}function Q(a,e){if(!a||!e)return;let t=ee(e),o=a.querySelector("i");a.title=t?"Desfavoritar":"Favoritar",o&&(t?(o.classList.remove("bi-star"),o.classList.add("bi-star-fill"),a.classList.contains("btn-link")?a.classList.add("active"):(a.classList.remove("btn-outline-warning"),a.classList.add("btn-warning","active"))):(o.classList.remove("bi-star-fill"),o.classList.add("bi-star"),a.classList.contains("btn-link")?a.classList.remove("active"):(a.classList.remove("btn-warning","active"),a.classList.add("btn-outline-warning"))))}function Ie(a){let e=a.target.closest(".btn-favoritar");if(!e)return;let t=e.dataset.pncpId;if(!t)return;let o=!1;if(ee(t)?o=ge(t):o=Be(t),o){Q(e,t);let i=I.querySelector(`.btn-favoritar[data-pncp-id="${t}"]`);i&&i!==e&&Q(i,t);let n=document.getElementById("detailsPanelFavoriteBtn");n&&n!==e&&n.dataset.pncpId===t&&Q(n,t),me()}}I&&I.addEventListener("click",Ie),ce&&ce.addEventListener("click",function(a){a.target.closest("#detailsPanelFavoriteBtn")&&Ie(a)}),document.addEventListener("click",function(a){let e=a.target.closest(".btn-remover-fav-sidebar");if(e){a.preventDefault(),a.stopPropagation();let o=e.dataset.pncpId;if(o){ge(o),me();let i=I.querySelector(`.btn-favoritar[data-pncp-id="${o}"]`);i&&Q(i,o);let n=document.getElementById("detailsPanelFavoriteBtn");n&&n.dataset.pncpId===o&&Q(n,o)}}let t=a.target.closest(".sidebar-fav-link");if(t){a.preventDefault();let o=t.dataset.pncpId,i=document.createElement("button");i.dataset.pncpId=o,xe({currentTarget:i})}});async function me(){let a=document.getElementById("lista-favoritos-sidebar"),e=document.getElementById("lista-favoritos-offcanvas");if(!a&&!e)return;let t=X(),o='<li class="list-group-item text-muted small">Nenhuma licita\xE7\xE3o favoritada ainda.</li>',i='<li class="list-group-item text-muted small"><div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>Carregando...</li>',n='<li class="list-group-item text-danger small fst-italic">Erro ao carregar dados dos favoritos.</li>';if(a&&(a.innerHTML=i),e&&(e.innerHTML=i),t.length===0){a&&(a.innerHTML=o),e&&(e.innerHTML=o);return}let s=!1;for(let r of t){let l=he[r];if(!l)try{let c=await fetch(`/api/frontend/licitacao/${encodeURIComponent(r)}`);if(c.ok){let $=await c.json();$.licitacao&&(l=$.licitacao,he[r]=l)}}catch(c){console.error("Erro ao buscar favorito para sidebar:",c)}if(l){s||(a&&(a.innerHTML=""),e&&(e.innerHTML=""),s=!0);let c=l.objetoCompra||l.numeroControlePNCP,$=`
                    <li class="list-group-item d-flex justify-content-between align-items-center py-1 px-1" style="font-size: 0.78em;">
                        <a href="#" class="text-decoration-none text-dark flex-grow-1 me-1 sidebar-fav-link" title="${c}" data-pncp-id="${r}">
                            ${c.length>45?c.substring(0,42)+"...":c}
                        </a>
                        <button class="btn btn-sm btn-outline-danger p-0 px-1 btn-remover-fav-sidebar" title="Remover dos Favoritos" data-pncp-id="${r}">
                            <i class="bi bi-x-lg" style="font-size: 0.7em;"></i>
                        </button>
                    </li>
                `;a&&a.insertAdjacentHTML("beforeend",$),e&&e.insertAdjacentHTML("beforeend",$)}}!s&&t.length>0&&(a&&(a.innerHTML=n),e&&(e.innerHTML=n))}async function De(){if(S){S.innerHTML='<small class="text-muted">Carregando modalidades...</small>';try{let a=await fetch("/api/frontend/referencias/modalidades");if(!a.ok)throw new Error(`Erro ${a.status} ao buscar modalidades.`);let e=await a.json();S.innerHTML="",e&&e.length>0?(e.sort((t,o)=>t.modalidadeNome.localeCompare(o.modalidadeNome)),e.forEach(t=>{let o=document.createElement("div");o.classList.add("form-check"),o.innerHTML=`
                        <input class="form-check-input filter-modalidade" type="checkbox" value="${t.modalidadeId}" id="mod-${t.modalidadeId}">
                        <label class="form-check-label" for="mod-${t.modalidadeId}">${t.modalidadeNome}</label>
                    `,S.appendChild(o),o.querySelector(".filter-modalidade").addEventListener("change",j)})):S.innerHTML='<small class="text-danger">Nenhuma modalidade encontrada.</small>'}catch(a){console.error("Erro ao carregar modalidades:",a),S.innerHTML=`<small class="text-danger">Erro ao carregar modalidades: ${a.message}</small>`}j()}}async function Ne(){if(B){B.innerHTML='<small class="text-muted">Carregando status...</small>';try{let a=await fetch("/api/frontend/referencias/statusradar");if(!a.ok)throw new Error(`Erro ${a.status} ao buscar status radar.`);let e=await a.json();if(B.innerHTML="",e&&e.length>0){let t="A Receber/Recebendo Proposta";e.sort((n,s)=>n.nome.localeCompare(s.nome)),e.forEach(n=>{let s=document.createElement("div");s.classList.add("form-check");let r=n.id===t,l=`status-radar-${n.id.toLowerCase().replace(/[^a-z0-9-_]/g,"")||"unk"}`;s.innerHTML=`
                        <input class="form-check-input filter-status" type="radio" name="statusLicitacao" 
                            value="${n.id}" id="${l}" ${r?"checked":""}>
                        <label class="form-check-label" for="${l}">${n.nome}</label>
                    `,B.appendChild(s)});let o=document.createElement("div");o.classList.add("form-check");let i="status-radar-todos";o.innerHTML=`
                    <input class="form-check-input filter-status" type="radio" name="statusLicitacao" value="" id="${i}">
                    <label class="form-check-label" for="${i}">Todos</label>
                `,B.appendChild(o),document.querySelectorAll(".filter-status").forEach(n=>{n.addEventListener("change",He)})}else B.innerHTML='<small class="text-danger">Nenhum status encontrado.</small>'}catch(a){console.error("Erro ao carregar status radar:",a),B.innerHTML=`<small class="text-danger">Erro ao carregar status: ${a.message}</small>`}}}function we(){M&&(M.innerHTML="",Ae.forEach(a=>{let e=document.createElement("div");e.classList.add("form-check");let t=`uf-${a.sigla.toLowerCase().replace(/[^a-z0-9-_]/g,"")}`;e.innerHTML=`
                <input class="form-check-input filter-uf" type="checkbox" value="${a.sigla}" id="${t}">
                <label class="form-check-label" for="${t}">${a.nome} (${a.sigla})</label>
            `,M.appendChild(e)}),document.querySelectorAll(".filter-uf").forEach(a=>{a.addEventListener("change",ie)}),oe())}async function ie(){oe();let a=Array.from(document.querySelectorAll(".filter-uf:checked")).map(s=>s.value),e=document.getElementById("municipiosContainerDropdown"),t=document.getElementById("dropdownMunicipiosButton"),o=document.getElementById("municipiosHelp");if(!e||!t)return;if(t.disabled=!0,e.innerHTML="",a.length===0){e.innerHTML='<small class="text-muted p-2">Selecione uma UF primeiro</small>',o&&(o.textContent="Selecione uma ou mais UFs para listar os munic\xEDpios."),ne();return}t.disabled=!1,e.innerHTML='<div class="p-2 text-muted">Carregando munic\xEDpios...</div>',o&&(o.textContent=`Carregando munic\xEDpios para ${a.join(", ")}...`);let i=[],n=[];for(let s of a)try{let r=await fetch(`/api/ibge/municipios/${s}`),l=await r.json();if(console.log(`Resposta da API para UF ${s}:`,l),!r.ok){n.push(s);continue}l.forEach(c=>{i.push({id:`${s}-${c.id}`,nome:`${c.nome} (${s})`,nomeOriginal:c.nome,uf:s})})}catch(r){console.error(`Erro cr\xEDtico ao carregar munic\xEDpios para ${s}:`,r),n.push(s)}i.sort((s,r)=>s.nome.localeCompare(r.nome)),e.innerHTML="",i.length>0?(i.forEach(s=>{let r=document.createElement("div");r.classList.add("form-check","ms-2");let l=`mun-${s.id.replace(/[^a-zA-Z0-9]/g,"")}`;r.innerHTML=`
                    <input class="form-check-input filter-municipio" type="checkbox" value="${s.nomeOriginal}" id="${l}">
                    <label class="form-check-label" for="${l}">${s.nome}</label>
                `,e.appendChild(r)}),document.querySelectorAll(".filter-municipio").forEach(s=>{s.addEventListener("change",ne)}),o&&(o.textContent=`Munic\xEDpios de ${a.join(", ")}. Selecione um ou mais.`)):(e.innerHTML='<small class="text-danger p-2">Nenhum munic\xEDpio encontrado.</small>',o&&(o.textContent="Nenhum munic\xEDpio encontrado para as UFs selecionadas.")),n.length>0&&o&&(o.textContent+=` (Erro ao carregar de: ${n.join(", ")})`),ne()}function He(a){let e=a.target.value}async function w(a=1){console.log(`[DEBUG] \u{1F4E1} BUSCANDO LICITA\xC7\xD5ES... P\xE1gina: ${a}`),Y();let e=document.getElementById("btnBuscarLicitacoes");e&&(e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Buscando...'),F=a;let t=new URLSearchParams;q&&q.classList.remove("d-none"),b.length>0&&b.forEach(d=>t.append("palavraChave",d)),L.length>0&&L.forEach(d=>t.append("excluirPalavra",d)),document.querySelectorAll(".filter-uf:checked").forEach(d=>t.append("uf",d.value)),document.querySelectorAll(".filter-modalidade:checked").forEach(d=>t.append("modalidadeId",d.value));let o=document.querySelector(".filter-status:checked"),i="";if(o&&(i=o.value),i&&t.append("statusRadar",i),x&&x.classList.add("d-none"),(i===""||i==="Encerrada")&&b.length===0){x&&(x.textContent="Palavra-chave de busca \xE9 obrigat\xF3ria para este status.",x.classList.remove("d-none")),I&&(I.innerHTML='<tr><td colspan="8" class="text-center text-danger">Forne\xE7a uma palavra-chave para buscar com o status selecionado.</td></tr>'),J&&(J.textContent="0"),R&&(R.textContent=""),A&&(A.innerHTML=""),q&&q.classList.add("d-none"),e&&(e.disabled=!1,e.innerHTML='<i class="bi bi-search"></i> Aplicar Filtros');return}let n=Array.from(document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked")).map(d=>d.value);n.length>0&&n.forEach(d=>t.append("municipioNome",d));let s=C.value;s&&t.append("dataPubInicio",s);let r=k.value;if(r&&t.append("dataPubFim",r),u&&m){let d=u.value;d&&t.append("dataAtualizacaoInicio",d);let h=m.value;h&&t.append("dataAtualizacaoFim",h)}let l=f.value;l&&t.append("valorMin",l);let c=y.value;c&&t.append("valorMax",c),t.append("pagina",F),t.append("porPagina",V.value);let[$,H]=O.value.split("_");t.append("orderBy",$),t.append("orderDir",H.toUpperCase()),I.innerHTML='<tr><td colspan="8" class="text-center">Buscando licita\xE7\xF5es... <div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>',J.textContent="-",R.textContent="";try{console.log("[DEBUG] \u2699\uFE0F Par\xE2metros da API:",t.toString());let d=await fetch(`/api/frontend/licitacoes?${t.toString()}`);if(!d.ok){let p=await d.json().catch(()=>({}));console.error("Erro da API:",d.status,p);let g=`Erro ${d.status}`;throw d.status===400&&p.erro?g=`Erro de valida\xE7\xE3o: ${p.erro}${p.detalhes?" ("+p.detalhes+")":""}`:d.status===404?g="Recurso n\xE3o encontrado no servidor (404).":p.erro_backend?g=`Erro no servidor: ${p.erro_backend}`:p.erro_frontend?g=`Erro no servidor do frontend: ${p.erro_frontend}`:d.statusText&&(g=`Erro ${d.status}: ${d.statusText}`),new Error(`Erro na API: ${d.status}`)}let h=await d.json();if(console.log("[DEBUG] \u2705 Dados recebidos da API:",h),Fe(h.licitacoes),Re(h),Le(),J.textContent=h.total_registros||"0",h.licitacoes&&h.licitacoes.length>0){let p=(h.pagina_atual-1)*parseInt(h.por_pagina,10)+1,g=p+h.licitacoes.length-1;R.textContent=`Exibindo ${p}-${g} de ${h.total_registros}`}else R.textContent="Nenhum resultado",(!h.total_registros||h.total_registros===0)&&(I.innerHTML='<tr><td colspan="8" class="text-center">Nenhuma licita\xE7\xE3o encontrada para os filtros aplicados.</td></tr>')}catch(d){console.error("[DEBUG] \u{1F4A5} Erro cr\xEDtico ao buscar licita\xE7\xF5es:",d),I.innerHTML=`<tr><td colspan="8" class="text-center text-danger">Erro ao buscar licita\xE7\xF5es: ${d.message}</td></tr>`,J.textContent="0",R.textContent="Erro",A.innerHTML=""}finally{q&&q.classList.add("d-none"),e&&(e.disabled=!1,e.innerHTML='<i class="bi bi-search"></i> Aplicar Filtros'),console.log("[DEBUG] \u{1F3C1} Fim da busca.")}}function Fe(a){if(I){if(I.innerHTML="",!a||a.length===0){I.innerHTML='<tr><td colspan="8" class="text-center">Nenhuma licita\xE7\xE3o encontrada para os filtros aplicados.</td></tr>';return}a.forEach(e=>{let t=document.createElement("tr"),o=Ce(e.situacaoReal),i=e.objetoCompra||"N/I",n=i.substring(0,100),s=i;i.length>100&&(s=`<span class="objeto-curto">${n}... <a href="#" class="ver-mais-objeto" data-objeto-completo="${e.id}">Ver mais</a></span>
                            <span class="objeto-completo d-none">${i} <a href="#" class="ver-menos-objeto" data-objeto-completo="${e.id}">Ver menos</a></span>`);let r="N/I";e.valorTotalEstimado===null?r='<span class="text-info fst-italic">Sigiloso</span>':e.valorTotalEstimado!==void 0&&e.valorTotalEstimado!==""&&!isNaN(parseFloat(e.valorTotalEstimado))?r=`R$ ${parseFloat(e.valorTotalEstimado).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`:(typeof e.valorTotalEstimado=="string"&&e.valorTotalEstimado.trim()===""||!e.valorTotalEstimado&&e.valorTotalEstimado!==0)&&(r='<span class="text-info fst-italic">Sigiloso</span>');let l=ee(e.numeroControlePNCP),c=`
                <button class="btn btn-sm ${l?"btn-warning active":"btn-outline-warning"} btn-favoritar" 
                        title="${l?"Desfavoritar":"Favoritar"}" data-pncp-id="${e.numeroControlePNCP}">
                    <i class="bi ${l?"bi-star-fill":"bi-star"}"></i>
                </button>
            `;t.innerHTML=`
                <td data-label="Munic\xEDpio/UF" class="align-middle">${e.unidadeOrgaoMunicipioNome||"N/I"}/${e.unidadeOrgaoUfSigla||"N/I"}</td>
                <td data-label="Objeto"><div class="objeto-container" data-lic-id="${e.id}">${s}</div></td>
                <td data-label="\xD3rg\xE3o" class="align-middle">${e.orgaoEntidadeRazaoSocial||"N/I"}</td>
                <td data-label="Status" class="align-middle"><span class="badge ${o}">${e.situacaoReal||e.situacaoCompraNome||"N/I"}</span></td>
                <td data-label="Valor (R$)" class="align-middle">${r}</td>
                <td data-label="Modalidade" class="align-middle">${e.modalidadeNome||"N/I"}</td>
                <td data-label="Atualiza\xE7\xE3o" class="align-middle">${e.dataAtualizacao?new Date(e.dataAtualizacao+"T00:00:00Z").toLocaleDateString("pt-BR"):"N/I"}</td>
                <td data-label="A\xE7\xF5es" class="text-nowrap align-middle">
                    <button class="btn btn-sm btn-info btn-detalhes" title="Mais Detalhes" data-pncp-id="${e.numeroControlePNCP}"><i class="bi bi-eye-fill"></i></button>                                                
                    ${c}
                </td>
            `,I.appendChild(t)}),document.querySelectorAll(".ver-mais-objeto").forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();let o=this.closest(".objeto-container");o.querySelector(".objeto-curto").classList.add("d-none"),o.querySelector(".objeto-completo").classList.remove("d-none")})}),document.querySelectorAll(".ver-menos-objeto").forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();let o=this.closest(".objeto-container");o.querySelector(".objeto-completo").classList.add("d-none"),o.querySelector(".objeto-curto").classList.remove("d-none")})}),document.querySelectorAll(".btn-detalhes").forEach(e=>{e.addEventListener("click",xe)})}}function Ce(a){if(!a)return"bg-secondary";let e=a.toLowerCase();return e.includes("recebendo")||e.includes("aberta")||e.includes("divulgada")?"bg-success":e.includes("encerrada")||e.includes("homologada")||e.includes("conclu\xEDda")?"bg-primary":e.includes("julgamento")?"bg-warning text-dark":e.includes("suspensa")?"bg-info text-dark":e.includes("anulada")||e.includes("revogada")||e.includes("cancelada")?"bg-danger":"bg-secondary"}function Re(a){if(A.innerHTML="",!a||!a.licitacoes||a.total_paginas==null||a.total_paginas<=1)return;let e=parseInt(a.pagina_atual,10),t=parseInt(a.total_paginas,10);if(isNaN(e)||isNaN(t))return;let o=document.createElement("li");o.classList.add("page-item"),e===1&&o.classList.add("disabled"),o.innerHTML=`<a class="page-link" href="#" data-page="${e-1}">Anterior</a>`,A.appendChild(o);let i=Math.max(1,e-2),n=Math.min(t,e+2),s=5;if(n-i+1<s){if(e<s/2)n=Math.min(t,i+s-1);else if(e>t-s/2)i=Math.max(1,n-s+1);else{let l=Math.floor((s-(n-i+1))/2);i=Math.max(1,i-l),n=Math.min(t,n+(s-(n-i+1)-l))}n-i+1>s&&(i===1?n=i+s-1:i=n-s+1)}if(i>1){let l=document.createElement("li");if(l.classList.add("page-item"),l.innerHTML='<a class="page-link" href="#" data-page="1">1</a>',A.appendChild(l),i>2){let c=document.createElement("li");c.classList.add("page-item","disabled"),c.innerHTML='<span class="page-link">...</span>',A.appendChild(c)}}for(let l=i;l<=n;l++){let c=document.createElement("li");c.classList.add("page-item"),l===e&&c.classList.add("active"),c.innerHTML=`<a class="page-link" href="#" data-page="${l}">${l}</a>`,A.appendChild(c)}if(n<t){if(n<t-1){let c=document.createElement("li");c.classList.add("page-item","disabled"),c.innerHTML='<span class="page-link">...</span>',A.appendChild(c)}let l=document.createElement("li");l.classList.add("page-item"),l.innerHTML=`<a class="page-link" href="#" data-page="${t}">${t}</a>`,A.appendChild(l)}let r=document.createElement("li");r.classList.add("page-item"),e===t&&r.classList.add("disabled"),r.innerHTML=`<a class="page-link" href="#" data-page="${e+1}">Pr\xF3xima</a>`,A.appendChild(r),A.querySelectorAll(".page-link").forEach(l=>{l.addEventListener("click",function(c){c.preventDefault();let $=this.closest(".page-item");if($&&($.classList.contains("disabled")||$.classList.contains("active")))return;let H=parseInt(this.dataset.page);H&&!isNaN(H)&&w(H)})})}function Se(){console.log("[DEBUG] \u{1F5D1}\uFE0F INICIANDO LIMPEZA TOTAL DE FILTROS..."),le&&(le.value=""),re&&(re.value=""),console.log("[DEBUG] Limpando arrays de palavras-chave em mem\xF3ria..."),b=[],L=[],N(b,K,"inclusao"),N(L,Z,"exclusao"),document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked").forEach(i=>i.checked=!1),typeof oe=="function"&&oe(),ie(),document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked").forEach(i=>i.checked=!1),typeof j=="function"&&j();let a=document.querySelectorAll(".filter-status"),e=null,t="A Receber/Recebendo Proposta";if(a.forEach(i=>{i.value===t&&(e=i)}),e)e.checked=!0;else if(a.length>0){let i=Array.from(a).find(n=>n.value!=="");i?i.checked=!0:a.length>0&&(a[0].checked=!0)}x.classList.add("d-none"),C&&(C.value=""),k&&(k.value=""),u&&(u.value=""),m&&(m.value=""),f&&(f.value=""),y&&(y.value="");let o=document.getElementById("collapseAdvanced");o&&o.classList.contains("show")&&new bootstrap.Collapse(o).hide(),console.log("[DEBUG] Chamando salvarFiltrosAtuais() ap\xF3s zerar os arrays..."),Y(),console.log("[DEBUG] Limpeza conclu\xEDda. Acionando nova busca..."),Le(),w(1)}let ke=document.getElementById("detailsPanel"),$e=ke?new bootstrap.Offcanvas(ke):null,U=document.getElementById("detailsPanelContent");async function xe(a){let t=a.currentTarget.dataset.pncpId;if(!(!t||!$e)){U.innerHTML='<p class="text-center">Carregando detalhes...</p>',document.getElementById("detailsPanelItensTableBody").innerHTML="",document.getElementById("detailsPanelItensPagination").innerHTML="",document.getElementById("detailsPanelArquivosList").innerHTML="",$e.show();try{let o=await fetch(`/api/frontend/licitacao/${encodeURIComponent(t)}`);if(!o.ok){let n=await o.json().catch(()=>({erro_frontend:"Erro desconhecido na resposta da API de detalhes."}));throw new Error(n.erro_backend||n.erro_frontend||`Erro ${o.status}`)}let i=await o.json();console.log("[DEBUG] Dados de DETALHES recebidos para PNCP ID:",t,JSON.parse(JSON.stringify(i))),Oe(i)}catch(o){console.error("Erro ao buscar detalhes da licita\xE7\xE3o:",o),U.innerHTML=`<p class="text-center text-danger">Erro ao carregar detalhes: ${o.message}</p>`}}}I&&I.addEventListener("click",function(a){let e=a.target.closest("tr");if(!e||a.target.closest("a, button"))return;let t=I.querySelector(".linha-selecionada");t&&t.classList.remove("linha-selecionada"),e.classList.add("linha-selecionada")});function Oe(a){if(!ce)return;if(!a||!a.licitacao){U.innerHTML='<p class="text-center text-danger">Dados da licita\xE7\xE3o n\xE3o encontrados.</p>';return}let e=a.licitacao,t=document.getElementById("detailsPanelSubtitle"),o=document.getElementById("detailsPanelLabel"),i=document.getElementById("detailsPanelFavoriteIconContainer");if(i&&(i.innerHTML="",e&&e.numeroControlePNCP)){let p=ee(e.numeroControlePNCP),g=document.createElement("button");g.id="detailsPanelFavoriteBtn",g.classList.add("btn","btn-link","text-warning","p-0","btn-favoritar"),g.style.fontSize="1.5rem",g.dataset.pncpId=e.numeroControlePNCP,g.title=p?"Desfavoritar":"Favoritar",g.innerHTML=`<i class="bi ${p?"bi-star-fill":"bi-star"}"></i>`,i.appendChild(g)}let n=`Detalhes: ${e.numeroControlePNCP||"N/I"}`;e.unidadeOrgaoNome?n=e.unidadeOrgaoNome:e.processo&&(n=`Processo: ${e.processo}`),o&&(o.textContent=n),t&&(e.numeroCompra&&e.anoCompra?(t.textContent=`Edital: ${e.numeroCompra}/${e.anoCompra}`,t.style.display="block"):e.numeroCompra?(t.textContent=`N\xFAmero da Compra: ${e.numeroCompra}`,t.style.display="block"):(t.textContent="",t.style.display="none"));let s=p=>p?new Date(p+"T00:00:00Z").toLocaleDateString("pt-BR"):"N/I",r="";e.numeroCompra&&e.anoCompra?r=`<p class="mb-1"><strong>Edital:</strong> ${e.numeroCompra}/${e.anoCompra}</small></p>`:e.numeroCompra&&(r=`<p class="mb-0"><strong>N\xFAmero Compra:</strong> ${e.numeroCompra}</small></p>`);let l=` 
            <p><strong>N\xFAmero PNCP:</strong> ${e.numeroControlePNCP||"N/I"}</p>
            ${e.processo?`<p><strong>N\xFAmero do Processo:</strong> ${e.processo}</p>`:""}     
            <p><strong>Objeto:</strong></p>
            <div class="mb-2" style="white-space: pre-wrap; background-color: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 150px; overflow-y: auto;">${e.objetoCompra||"N/I"}</div>
            <p><strong>\xD3rg\xE3o:</strong> ${e.orgaoEntidadeRazaoSocial||"N/I"}</p>
            <p><strong>Unidade Compradora:</strong> ${e.unidadeOrgaoNome||"N/I"}</p>
            <p><strong>Munic\xEDpio/UF:</strong> ${e.unidadeOrgaoMunicipioNome||"N/I"}/${e.unidadeOrgaoUfSigla||"N/I"}</p>
            <p><strong>Modalidade:</strong> ${e.modalidadeNome||"N/I"}</p>                    
            ${e.amparoLegalNome?`<p><strong>Amparo Legal:</strong> ${e.amparoLegalNome}</p>`:""}
            ${e.valorTotalHomologado?`<p><strong>Valor Total Homologado:</strong> R$ ${parseFloat(e.valorTotalHomologado).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}</p>`:""}
            ${e.modoDisputaNome?`<p><strong>Modo de Disputa:</strong> ${e.modoDisputaNome}</p>`:'<p class="text-muted small"><small><strong>Modo de Disputa:</strong> (N\xE3o informado)</small></p>'}
            ${e.tipolnstrumentoConvocatorioNome?`<p><strong>Tipo:</strong> ${e.tipolnstrumentoConvocatorioNome}</p>`:'<p class="text-muted small"><small><strong>Tipo:</strong> (N\xE3o informado)</small></p>'}
            <p><strong>Situa\xE7\xE3o Atual:</strong> <span class="badge ${Ce(e.situacaoReal)}">${e.situacaoReal||"N/I"}</span></p>                
            <p><strong>Data Publica\xE7\xE3o PNCP:</strong> ${s(e.dataPublicacaoPncp)}</p>                
            <div class="my-2 p-2 border-start border-primary border-3 bg-light-subtle rounded-end">
                <p class="mb-1"><strong>In\xEDcio Recebimento Propostas:</strong> ${be(e.dataAberturaProposta)} (Hor\xE1rio de Bras\xEDlia)</p>
                <p class="mb-0"><strong>Fim Recebimento Propostas:</strong> ${be(e.dataEncerramentoProposta)} (Hor\xE1rio de Bras\xEDlia)</p>
            </div>
            <p><strong>\xDAltima Atualiza\xE7\xE3o:</strong> ${s(e.dataAtualizacao)}</p>            
            <p><strong>Valor Total Estimado:</strong> ${e.valorTotalEstimado===null?'<span class="text-info fst-italic">Sigiloso</span>':e.valorTotalEstimado?`R$ ${parseFloat(e.valorTotalEstimado).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"Sigiloso"}</p>
            <p><strong>Informa\xE7\xE3o Complementar:</strong></p>
            <div style="white-space: pre-wrap; background-color: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 150px; overflow-y: auto;">
                ${e.informacaoComplementar||"Nenhuma"}
            </div>
        `,c="";if(e.justificativaPresencial){let p=e.justificativaPresencial,g=200;p.length>g?c=`
                    <p><strong>Justificativa Presencial:</strong></p>
                    <div class="justificativa-container">
                        <span class="justificativa-curta" style="white-space: pre-wrap;">${p.substring(0,g)}... <a href="#" class="ver-mais-justificativa">Ver mais</a></span>
                        <span class="justificativa-completa d-none" style="white-space: pre-wrap;">${p} <a href="#" class="ver-menos-justificativa">Ver menos</a></span>
                    </div>`:c=`<p><strong>Justificativa Presencial:</strong></p><div style="white-space: pre-wrap;">${p}</div>`}l+=c,U.innerHTML=l;let $=U.querySelector(".ver-mais-justificativa");$&&$.addEventListener("click",function(p){p.preventDefault();let g=this.closest(".justificativa-container");g.querySelector(".justificativa-curta").classList.add("d-none"),g.querySelector(".justificativa-completa").classList.remove("d-none")});let H=U.querySelector(".ver-menos-justificativa");H&&H.addEventListener("click",function(p){p.preventDefault();let g=this.closest(".justificativa-container");g.querySelector(".justificativa-completa").classList.add("d-none"),g.querySelector(".justificativa-curta").classList.remove("d-none")});let d=document.getElementById("detailsPanelBtnPncp");d&&(e.link_portal_pncp&&e.link_portal_pncp.trim()!==""?(d.href=e.link_portal_pncp,d.classList.remove("disabled"),d.removeAttribute("aria-disabled")):(d.href="#",d.classList.add("disabled"),d.setAttribute("aria-disabled","true")));let h=document.getElementById("detailsPanelBtnSistemaOrigem");h&&(e.linkSistemaOrigem&&e.linkSistemaOrigem.trim()!==""?(h.disabled=!1,h.innerHTML='<i class="bi bi-building"></i> Acessar Sistema de Origem',h.onclick=()=>{window.open(e.linkSistemaOrigem,"_blank")}):(h.disabled=!0,h.innerHTML='<i class="bi bi-building"></i> Sistema de Origem (N\xE3o dispon\xEDvel)',h.onclick=null)),qe(a.itens||[]),je(a.arquivos||[])}let z=[],D=1,pe=5;function qe(a){z=a,D=1,fe()}function fe(){let a=document.getElementById("detailsPanelItensTableBody"),e=document.getElementById("detailsPanelItensPagination");if(a.innerHTML="",e.innerHTML="",!z||z.length===0){a.innerHTML='<tr><td colspan="5" class="text-center">Nenhum item encontrado.</td></tr>';return}let t=Math.ceil(z.length/pe),o=(D-1)*pe,i=o+pe;if(z.slice(o,i).forEach(s=>{let r=document.createElement("tr"),l="N/I";s.valorUnitarioEstimado===null?l='<span class="text-info fst-italic">Sigiloso</span>':s.valorUnitarioEstimado!==void 0&&s.valorUnitarioEstimado!==""&&!isNaN(parseFloat(s.valorUnitarioEstimado))&&(l=parseFloat(s.valorUnitarioEstimado).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}));let c="N/I";s.valorTotal===null?c='<span class="text-info fst-italic">Sigiloso</span>':s.valorTotal!==void 0&&s.valorTotal!==""&&!isNaN(parseFloat(s.valorTotal))&&(c=parseFloat(s.valorTotal).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),r.innerHTML=`
                <td data-label="Item">${s.numeroItem||"N/I"}</td>
                <td data-label="Descri\xE7\xE3o">${s.descricao||"N/I"}</td>
                <td data-label="Qtde." class="text-end">${s.quantidade||"N/I"}</td>
                <td data-label="Un." class="text-center">${s.unidadeMedida||"N/I"}</td>
                <td data-label="Vl. Unit." class="text-end">${l}</td>
                <td data-label="Vl. Total" class="text-end">${c}</td>
            `,a.appendChild(r)}),t>1){let s=document.createElement("li");s.classList.add("page-item"),D===1&&s.classList.add("disabled"),s.innerHTML='<a class="page-link page-link-sm" href="#">Ant</a>',s.addEventListener("click",c=>{c.preventDefault(),D>1&&(D--,fe())}),e.appendChild(s);let r=document.createElement("li");r.classList.add("page-item","disabled"),r.innerHTML=`<span class="page-link page-link-sm">${D}/${t}</span>`,e.appendChild(r);let l=document.createElement("li");l.classList.add("page-item"),D===t&&l.classList.add("disabled"),l.innerHTML='<a class="page-link page-link-sm" href="#">Pr\xF3x</a>',l.addEventListener("click",c=>{c.preventDefault(),D<t&&(D++,fe())}),e.appendChild(l)}else if(t===1&&z.length>0){let s=document.createElement("li");s.classList.add("page-item"),s.classList.add("disabled"),s.innerHTML=`<span class="page-link page-link-sm">${D} / ${t}</span>`,e.appendChild(s)}}function je(a){let e=document.getElementById("detailsPanelArquivosList");if(e.innerHTML="",!a||a.length===0){let t=document.createElement("li");t.classList.add("list-group-item"),t.textContent="Nenhum arquivo encontrado.",e.appendChild(t);return}a.forEach(t=>{let o=document.createElement("li");o.classList.add("list-group-item"),o.innerHTML=`<a href="${t.link_download}" target="_blank"><i class="bi bi-file-earmark-arrow-down"></i> ${t.titulo||"Arquivo sem t\xEDtulo"}</a>`,e.appendChild(o)})}async function Ue(){console.log("[DEBUG] \u{1F3C1} INICIALIZANDO A P\xC1GINA..."),we(),await De(),await Ne(),Me(),me(),w(1),ue("ufSearchInput","ufsContainerDropdown",".form-check"),ue("modalidadeSearchInput","modalidadesContainerDropdown",".form-check"),ue("municipioSearchInput","municipiosContainerDropdown",".form-check"),ye(le,K,"inclusao"),ye(re,Z,"exclusao"),G&&G.addEventListener("click",()=>w(1)),P&&P.addEventListener("click",Se),O&&O.addEventListener("change",()=>w(F||1)),V&&V.addEventListener("change",()=>w(1));let a=document.getElementById("btnAtualizarTabela");a&&(a.disabled=!1,a.addEventListener("click",()=>{console.log("Bot\xE3o Atualizar Tabela clicado - Refazendo busca para p\xE1gina:",F),F<1&&(F=1),w(F)})),console.log("[DEBUG] \u2705 P\xE1gina inicializada e listeners configurados.")}Ue()}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Carregado. Orquestrador JS iniciado."),Te(),document.body.classList.contains("page-busca-licitacoes")&&ve()});})();
