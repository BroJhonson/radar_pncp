(()=>{(()=>{function fe(v,b,B){let M;return function(){let G=this,C=arguments,T=function(){M=null,B||v.apply(G,C)},S=B&&!M;clearTimeout(M),M=setTimeout(T,b),S&&v.apply(G,C)}}function De(){console.log("Configurando funcionalidades globais...");let v=document.getElementById("template-painel-feedback"),b=document.getElementById("feedback-placeholder-desktop"),B=document.getElementById("feedback-placeholder-mobile"),M=document.getElementById("mobileMenuButton");if(v&&b&&B){let g=()=>(b.innerHTML="",B.innerHTML="",v.content.cloneNode(!0)),u=()=>{let m=g();window.innerWidth>=992?b.appendChild(m):B.appendChild(m)};u(),window.addEventListener("resize",fe(u,200))}if(M){let g=document.querySelectorAll(".offcanvas"),u=M.closest(".dropdown");g.forEach(m=>{m.addEventListener("show.bs.offcanvas",()=>{u&&(u.style.zIndex="1040")}),m.addEventListener("hidden.bs.offcanvas",()=>{u&&(u.style.zIndex="")})})}function G(){window.scrollTo({top:0,behavior:"smooth"})}let C=document.getElementById("btnVoltarAoTopo");C&&(C.addEventListener("click",G),window.onscroll=function(){document.body.scrollTop>100||document.documentElement.scrollTop>100?C.classList.add("show"):C.classList.remove("show")});let T="radarPncpCookieConsent",S=document.getElementById("cookieConsentBanner"),I=document.getElementById("btnAceitarCookies");!localStorage.getItem(T)&&S&&setTimeout(()=>S.classList.add("show"),500),I&&I.addEventListener("click",()=>{localStorage.setItem(T,JSON.stringify({accepted:!0,timestamp:new Date().toISOString()})),S&&S.classList.remove("show")});function $(){let g=document.getElementById("logoDesktop"),u=document.getElementById("logoBuscaLicitacoes"),m=document.getElementById("logoMobile"),x=document.getElementById("logoBuscaLicitacoesMobile");!g||!u||!m||!x||(document.body.classList.contains("page-busca-licitacoes")?(g.style.display="none",u.style.display="inline-block",m.style.display="none",x.style.display="inline-block"):(g.style.display="inline-block",u.style.display="none",m.style.display="inline-block",x.style.display="none"))}if($(),document.body.classList.contains("page-home")){let g=function(){m.forEach(D=>D.classList.remove("active")),this.classList.add("active")},u=function(){let D=this.classList.contains("active");m.forEach(L=>L.classList.remove("active")),D||this.classList.add("active")};console.log("L\xF3gica da Home Page (acorde\xE3o) iniciada.");let m=document.querySelectorAll(".accordion-card"),x=()=>window.innerWidth<=767,_=()=>{m.forEach(D=>{D.removeEventListener("mouseover",g),D.removeEventListener("click",u)}),x()?m.forEach(D=>D.addEventListener("click",u)):m.forEach(D=>D.addEventListener("mouseover",g))};_(),window.addEventListener("resize",fe(_,250))}}var Y="radarPncpFavoritos";function ee(){let v=localStorage.getItem(Y);try{return v?JSON.parse(v):[]}catch(b){return console.error("Erro ao parsear favoritos do localStorage:",b),localStorage.removeItem(Y),[]}}function Be(v){if(!v)return!1;let b=ee();return b.includes(v)?!1:(b.push(v),localStorage.setItem(Y,JSON.stringify(b)),console.log("Adicionado aos favoritos:",v),!0)}function ve(v){if(!v)return!1;let b=ee(),B=b.indexOf(v);return B>-1?(b.splice(B,1),localStorage.setItem(Y,JSON.stringify(b)),console.log("Removido dos favoritos:",v),!0):!1}function te(v){return v?ee().includes(v):!1}function Te(){console.log("P\xE1gina de busca de licita\xE7\xF5es detectada. Inicializando funcionalidades...");let v=document.getElementById("filtrosAtivosContainer"),b=document.getElementById("filtrosAtivosTexto"),B=document.getElementById("linkLimparFiltrosRapido"),M=document.getElementById("ufsContainerDropdown"),G=document.getElementById("municipiosHelp"),C=document.getElementById("modalidadesContainerDropdown"),T=document.getElementById("statusContainer"),S=document.getElementById("statusWarning"),I=document.getElementById("dataPubInicio"),$=document.getElementById("dataPubFim"),g=document.getElementById("dataAtualizacaoInicio"),u=document.getElementById("dataAtualizacaoFim"),m=document.getElementById("valorMin"),x=document.getElementById("valorMax"),_=document.getElementById("btnBuscarLicitacoes"),D=document.getElementById("btnLimparFiltros"),L=document.getElementById("licitacoesTableBody"),A=document.getElementById("paginationControls"),J=document.getElementById("totalRegistrosInfo"),R=document.getElementById("exibicaoInfo"),q=document.getElementById("ordenarPor"),V=document.getElementById("itensPorPagina"),re=document.getElementById("palavraChaveInclusaoInput"),Z=document.getElementById("tagsPalavraInclusaoContainer"),se=document.getElementById("palavraChaveExclusaoInput"),W=document.getElementById("tagsPalavraExclusaoContainer"),j=document.getElementById("loadingOverlay"),ze=document.getElementById("lista-favoritos-sidebar"),de=document.getElementById("detailsPanel"),ce=document.getElementById("offcanvasFiltrosBody"),h=[],y=[],H=1,Ee={},Ae=[{sigla:"AC",nome:"Acre"},{sigla:"AL",nome:"Alagoas"},{sigla:"AP",nome:"Amap\xE1"},{sigla:"AM",nome:"Amazonas"},{sigla:"BA",nome:"Bahia"},{sigla:"CE",nome:"Cear\xE1"},{sigla:"DF",nome:"Distrito Federal"},{sigla:"ES",nome:"Esp\xEDrito Santo"},{sigla:"GO",nome:"Goi\xE1s"},{sigla:"MA",nome:"Maranh\xE3o"},{sigla:"MT",nome:"Mato Grosso"},{sigla:"MS",nome:"Mato Grosso do Sul"},{sigla:"MG",nome:"Minas Gerais"},{sigla:"PA",nome:"Par\xE1"},{sigla:"PB",nome:"Para\xEDba"},{sigla:"PR",nome:"Paran\xE1"},{sigla:"PE",nome:"Pernambuco"},{sigla:"PI",nome:"Piau\xED"},{sigla:"RJ",nome:"Rio de Janeiro"},{sigla:"RN",nome:"Rio Grande do Norte"},{sigla:"RS",nome:"Rio Grande do Sul"},{sigla:"RO",nome:"Rond\xF4nia"},{sigla:"RR",nome:"Roraima"},{sigla:"SC",nome:"Santa Catarina"},{sigla:"SP",nome:"S\xE3o Paulo"},{sigla:"SE",nome:"Sergipe"},{sigla:"TO",nome:"Tocantins"}],ae="radarPncpUltimosFiltros",K="radarPncpCollapseState",he=t=>{if(!t)return"N/I";try{let e=new Date(t);if(isNaN(e.getTime())){let a=new Date(t+"Z");return isNaN(a.getTime())?(console.warn("Data/hora inv\xE1lida recebida:",t),"Data/Hora Inv\xE1lida"):a.toLocaleString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}return e.toLocaleString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Erro ao formatar data e hora:",t,e),"Data/Hora Inv\xE1lida"}};B&&B.addEventListener("click",function(t){t.preventDefault(),Ce()});let be=document.getElementById("btnExportarCsv");be&&be.addEventListener("click",function(){let t=new URLSearchParams;h.length>0&&h.forEach(o=>t.append("palavraChave",o)),y.length>0&&y.forEach(o=>t.append("excluirPalavra",o)),document.querySelectorAll(".filter-uf:checked").forEach(o=>t.append("uf",o.value)),document.querySelectorAll(".filter-modalidade:checked").forEach(o=>t.append("modalidadeId",o.value));let e=document.querySelector(".filter-status:checked");e&&t.append("statusRadar",e.value),document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked").forEach(o=>t.append("municipioNome",o.value)),I.value&&t.append("dataPubInicio",I.value),$.value&&t.append("dataPubFim",$.value),g.value&&t.append("dataAtualizacaoInicio",g.value),u.value&&t.append("dataAtualizacaoFim",u.value),m.value&&t.append("valorMin",m.value),x.value&&t.append("valorMax",x.value);let[a,n]=q.value.split("_");t.append("orderBy",a),t.append("orderDir",n.toUpperCase()),console.log("Exportando com os seguintes par\xE2metros:",t.toString());let l=`/api/exportar-csv?${t.toString()}`;window.open(l,"_blank")}),ce&&(ce.addEventListener("keydown",function(t){if((t.key==="Enter"||t.key==="NumpadEnter")&&(t.ctrlKey||t.metaKey)){console.log("Ctrl+Enter pressionado, aplicando filtros..."),t.preventDefault(),N(1);let e=document.getElementById("offcanvasFiltros");if(e){let a=bootstrap.Offcanvas.getInstance(e);a&&a.hide()}}}),ce.addEventListener("click",function(t){if(t.target.classList.contains("btn-limpar-grupo")){let e=t.target.dataset.limpar;console.log(`[DEBUG] \u{1F5B1}\uFE0F Clique no 'X' do GRUPO '${e}'`);let a=!1;switch(e){case"status":let n=document.querySelector('.filter-status[value="A Receber/Recebendo Proposta"]');n&&(n.checked=!0);break;case"modalidades":document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked").forEach(l=>l.checked=!1),O();break;case"inclusao":h.length>0&&(h=[],w(h,Z,"inclusao"),a=!0);break;case"exclusao":y.length>0&&(y=[],w(y,W,"exclusao"),a=!0);break;case"localizacao":document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked").forEach(l=>l.checked=!1),ie();break;case"avancado":I&&(I.value=""),$&&($.value=""),g&&(g.value=""),u&&(u.value=""),m&&(m.value=""),x&&(x.value="");break}a&&Q(!0)}}));function w(t,e,a){console.log(`[DEBUG] \u{1F3A8} RENDERIZANDO TAGS para '${a}'. Dados:`,JSON.stringify(t)),e&&(e.innerHTML="",t.forEach((n,l)=>{let o=document.createElement("span");o.classList.add("tag-item"),o.textContent=n;let i=document.createElement("button");i.classList.add("remove-tag"),i.innerHTML="\xD7",i.title="Remover palavra",i.type="button",i.addEventListener("click",()=>{a==="inclusao"?(h.splice(l,1),w(h,Z,"inclusao")):a==="exclusao"&&(y.splice(l,1),w(y,W,"exclusao")),Q()}),o.appendChild(i),e.appendChild(o)}))}function oe(t,e,a,n){if(console.log(`[DEBUG] \u{1F4E5} Adicionando palavra-chave para '${n}'...`),!t)return;let l=t.value.trim();if(l){let o=l.split(/[,;]+/).map(r=>r.trim()).filter(r=>r!==""&&r.length>0),i=!1;o.forEach(r=>{e.includes(r)||(e.push(r),i=!0)}),t.value="",i&&(w(e,a,n),Q())}}function ye(t,e,a){t&&(t.addEventListener("keyup",function(n){(n.key==="Enter"||n.key==="NumpadEnter"||n.keyCode===13)&&(n.preventDefault(),a==="inclusao"?oe(t,h,e,a):a==="exclusao"&&oe(t,y,e,a))}),t.addEventListener("input",function(n){let l=t.value;(l.endsWith(",")||l.endsWith(";"))&&(t.value=l.slice(0,-1),a==="inclusao"?oe(t,h,e,a):a==="exclusao"&&oe(t,y,e,a))}))}function xe(){if(!v||!b)return;let t=[];h.length>0&&t.push(`Buscar: ${h.map(o=>`<span class="badge bg-primary">${o}</span>`).join(" ")}`),y.length>0&&t.push(`Excluir: ${y.map(o=>`<span class="badge bg-danger">${o}</span>`).join(" ")}`);let e=Array.from(document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked")).map(o=>o.value);e.length>0&&t.push(`UF: ${e.map(o=>`<span class="badge bg-secondary">${o}</span>`).join(" ")}`);let a=Array.from(document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked")).map(o=>o.value);a.length>0&&t.push(`Munic\xEDpio: ${a.map(o=>`<span class="badge bg-info text-dark">${o}</span>`).join(" ")}`);let n=Array.from(document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked")).map(o=>{let i=document.querySelector(`label[for="${o.id}"]`);return i?i.textContent:o.value});n.length>0&&t.push(`Modalidade: ${n.map(o=>`<span class="badge bg-warning text-dark">${o}</span>`).join(" ")}`);let l=document.querySelector(".filter-status:checked");if(l&&l.value){let o=document.querySelector(`label[for="${l.id}"]`);t.push(`Status: <span class="badge bg-success">${o?o.textContent:l.value}</span>`)}else l&&l.value===""&&t.push('Status: <span class="badge bg-dark">Todos</span>');if(I.value||$.value){let o="Data Pub.: ";I.value&&(o+=`de ${new Date(I.value+"T00:00:00").toLocaleDateString("pt-BR")} `),$.value&&(o+=`at\xE9 ${new Date($.value+"T00:00:00").toLocaleDateString("pt-BR")}`),t.push(`<span class="badge bg-light text-dark border">${o.trim()}</span>`)}if(g&&u&&(g.value||u.value)){let o="Data Atual.: ";g.value&&(o+=`de ${new Date(g.value+"T00:00:00").toLocaleDateString("pt-BR")} `),u.value&&(o+=`at\xE9 ${new Date(u.value+"T00:00:00").toLocaleDateString("pt-BR")}`),t.push(`<span class="badge bg-light text-dark border">${o.trim()}</span>`)}if(m.value||x.value){let o="Valor: ";m.value&&(o+=`min R$ ${m.value} `),x.value&&(o+=`max R$ ${x.value}`),t.push(`<span class="badge bg-light text-dark border">${o.trim()}</span>`)}t.length>0?(b.innerHTML=t.join(" \u2022 "),v.style.display="block"):b.innerHTML="Nenhum filtro aplicado."}function ne(){let t=document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked").length,e=document.getElementById("ufSelectedCount");e&&(e.textContent=t,e.style.display=t>0?"":"none")}function O(){let t=document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked").length,e=document.getElementById("modalidadesSelectedCount");e&&(e.textContent=t,e.style.display=t>0?"inline-block":"none")}function le(){let t=document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked").length,e=document.getElementById("municipiosSelectedCount");e&&(e.textContent=t,e.style.display=t>0?"inline-block":"none",t===0&&(e.textContent="0"))}function ue(t,e,a){let n=document.getElementById(t),l=document.getElementById(e);!n||!l||(n.addEventListener("input",function(){let o=n.value.toLowerCase();l.querySelectorAll(a).forEach(i=>{let r=i.querySelector("label");r&&(r.textContent.toLowerCase().includes(o)?i.style.display="block":i.style.display="none")})}),l.addEventListener("click",function(o){o.target.matches(".form-check-input")&&(n.value="",l.querySelectorAll(a).forEach(i=>{i.style.display="block"}))}))}function Q(){console.log("[DEBUG] \u{1F4BE} SALVANDO FILTROS no localStorage...");let t={palavrasChaveInclusao:h,palavrasChaveExclusao:y,status:document.querySelector(".filter-status:checked")?.value||"A Receber/Recebendo Proposta",ufs:Array.from(document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked")).map(e=>e.value),municipios:Array.from(document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked")).map(e=>e.value),modalidades:Array.from(document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked")).map(e=>e.value),dataPubInicio:I.value,dataPubFim:$.value,dataAtualizacaoInicio:g.value,dataAtualizacaoFim:u.value,valorMin:m.value,valorMax:x.value,ordenacao:q.value,itensPorPagina:V.value};localStorage.setItem(ae,JSON.stringify(t)),console.log("[DEBUG] \u2705 Filtros salvos. Estado atual:",{inclusao:h,exclusao:y}),console.log("[DEBUG] localStorage agora cont\xE9m:",localStorage.getItem(ae))}function Me(){console.log("[DEBUG] \u{1F504} CARREGANDO FILTROS do localStorage...");let t=localStorage.getItem(ae);if(!t){console.log("Nenhum filtro salvo encontrado.");return}try{let e=JSON.parse(t);if(console.log("Carregando filtros salvos:",e),e.palavrasChaveInclusao&&(h=e.palavrasChaveInclusao,w(h,Z,"inclusao")),e.palavrasChaveExclusao&&(y=e.palavrasChaveExclusao,w(y,W,"exclusao")),e.status){let a=document.querySelector(`.filter-status[value="${e.status}"]`);a&&(a.checked=!0)}e.ufs&&e.ufs.length>0&&(e.ufs.forEach(a=>{let n=document.querySelector(`#ufsContainerDropdown .filter-uf[value="${a}"]`);n&&(n.checked=!0)}),ie().then(()=>{e.municipios&&e.municipios.length>0&&(e.municipios.forEach(a=>{let n=document.querySelector(`#municipiosContainerDropdown .filter-municipio[value="${a}"]`);n&&(n.checked=!0)}),le())})),e.modalidades&&e.modalidades.length>0&&(e.modalidades.forEach(a=>{let n=document.querySelector(`#modalidadesContainerDropdown .filter-modalidade[value="${a}"]`);n&&(n.checked=!0)}),O()),e.dataPubInicio&&(I.value=e.dataPubInicio),e.dataPubFim&&($.value=e.dataPubFim),e.dataAtualizacaoInicio&&(g.value=e.dataAtualizacaoInicio),e.dataAtualizacaoFim&&(u.value=e.dataAtualizacaoFim),e.valorMin&&(m.value=e.valorMin),e.valorMax&&(x.value=e.valorMax),e.ordenacao&&(q.value=e.ordenacao),e.itensPorPagina&&(V.value=e.itensPorPagina)}catch(e){console.error("[DEBUG] \u274C Erro ao carregar/parsear filtros:",e),localStorage.removeItem(ae)}}document.querySelectorAll(".filter-collapsible .collapse").forEach(t=>{t.addEventListener("shown.bs.collapse",e=>{let a=JSON.parse(localStorage.getItem(K)||"{}");a[e.target.id]=!0,localStorage.setItem(K,JSON.stringify(a))}),t.addEventListener("hidden.bs.collapse",e=>{let a=JSON.parse(localStorage.getItem(K)||"{}");a[e.target.id]=!1,localStorage.setItem(K,JSON.stringify(a))})});function Ge(){let t=JSON.parse(localStorage.getItem(K)||"{}");for(let e in t)if(t[e]){let a=document.getElementById(e);a&&new bootstrap.Collapse(a,{toggle:!1}).show()}}function X(t,e){if(!t||!e)return;let a=te(e),n=t.querySelector("i");t.title=a?"Desfavoritar":"Favoritar",n&&(a?(n.classList.remove("bi-star"),n.classList.add("bi-star-fill"),t.classList.contains("btn-link")?t.classList.add("active"):(t.classList.remove("btn-outline-warning"),t.classList.add("btn-warning","active"))):(n.classList.remove("bi-star-fill"),n.classList.add("bi-star"),t.classList.contains("btn-link")?t.classList.remove("active"):(t.classList.remove("btn-warning","active"),t.classList.add("btn-outline-warning"))))}function Le(t){let e=t.target.closest(".btn-favoritar");if(!e)return;let a=e.dataset.pncpId;if(!a)return;let n=!1;if(te(a)?n=ve(a):n=Be(a),n){X(e,a);let l=L.querySelector(`.btn-favoritar[data-pncp-id="${a}"]`);l&&l!==e&&X(l,a);let o=document.getElementById("detailsPanelFavoriteBtn");o&&o!==e&&o.dataset.pncpId===a&&X(o,a),me()}}L&&L.addEventListener("click",Le),de&&de.addEventListener("click",function(t){t.target.closest("#detailsPanelFavoriteBtn")&&Le(t)}),document.addEventListener("click",function(t){let e=t.target.closest(".btn-remover-fav-sidebar");if(e){t.preventDefault(),t.stopPropagation();let n=e.dataset.pncpId;if(n){ve(n),me();let l=L.querySelector(`.btn-favoritar[data-pncp-id="${n}"]`);l&&X(l,n);let o=document.getElementById("detailsPanelFavoriteBtn");o&&o.dataset.pncpId===n&&X(o,n)}}let a=t.target.closest(".sidebar-fav-link");if(a){t.preventDefault();let n=a.dataset.pncpId,l=document.createElement("button");l.dataset.pncpId=n,Se({currentTarget:l})}});async function me(){let t=document.getElementById("lista-favoritos-sidebar"),e=document.getElementById("lista-favoritos-offcanvas");if(!t&&!e)return;let a=ee(),n='<li class="list-group-item text-muted small">Nenhuma licita\xE7\xE3o favoritada ainda.</li>',l='<li class="list-group-item text-muted small"><div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>Carregando...</li>',o='<li class="list-group-item text-danger small fst-italic">Erro ao carregar dados dos favoritos.</li>';if(t&&(t.innerHTML=l),e&&(e.innerHTML=l),a.length===0){t&&(t.innerHTML=n),e&&(e.innerHTML=n);return}let i=!1;for(let r of a){let s=Ee[r];if(!s)try{let d=await fetch(`/api/frontend/licitacao/${encodeURIComponent(r)}`);if(d.ok){let k=await d.json();k.licitacao&&(s=k.licitacao,Ee[r]=s)}}catch(d){console.error("Erro ao buscar favorito para sidebar:",d)}if(s){i||(t&&(t.innerHTML=""),e&&(e.innerHTML=""),i=!0);let d=s.objetoCompra||s.numeroControlePNCP,k=`
                    <li class="list-group-item d-flex justify-content-between align-items-center py-1 px-1" style="font-size: 0.78em;">
                        <a href="#" class="text-decoration-none text-dark flex-grow-1 me-1 sidebar-fav-link" title="${d}" data-pncp-id="${r}">
                            ${d.length>45?d.substring(0,42)+"...":d}
                        </a>
                        <button class="btn btn-sm btn-outline-danger p-0 px-1 btn-remover-fav-sidebar" title="Remover dos Favoritos" data-pncp-id="${r}">
                            <i class="bi bi-x-lg" style="font-size: 0.7em;"></i>
                        </button>
                    </li>
                `;t&&t.insertAdjacentHTML("beforeend",k),e&&e.insertAdjacentHTML("beforeend",k)}}!i&&a.length>0&&(t&&(t.innerHTML=o),e&&(e.innerHTML=o))}async function Pe(){if(C){C.innerHTML='<small class="text-muted">Carregando modalidades...</small>';try{let t=await fetch("/api/frontend/referencias/modalidades");if(!t.ok)throw new Error(`Erro ${t.status} ao buscar modalidades.`);let e=await t.json();C.innerHTML="",e&&e.length>0?(e.sort((a,n)=>a.modalidadeNome.localeCompare(n.modalidadeNome)),e.forEach(a=>{let n=document.createElement("div");n.classList.add("form-check"),n.innerHTML=`
                        <input class="form-check-input filter-modalidade" type="checkbox" value="${a.modalidadeId}" id="mod-${a.modalidadeId}">
                        <label class="form-check-label" for="mod-${a.modalidadeId}">${a.modalidadeNome}</label>
                    `,C.appendChild(n),n.querySelector(".filter-modalidade").addEventListener("change",O)})):C.innerHTML='<small class="text-danger">Nenhuma modalidade encontrada.</small>'}catch(t){console.error("Erro ao carregar modalidades:",t),C.innerHTML=`<small class="text-danger">Erro ao carregar modalidades: ${t.message}</small>`}O()}}async function we(){if(T){T.innerHTML='<small class="text-muted">Carregando status...</small>';try{let t=await fetch("/api/frontend/referencias/statusradar");if(!t.ok)throw new Error(`Erro ${t.status} ao buscar status radar.`);let e=await t.json();if(T.innerHTML="",e&&e.length>0){let a="A Receber/Recebendo Proposta";e.sort((o,i)=>o.nome.localeCompare(i.nome)),e.forEach(o=>{let i=document.createElement("div");i.classList.add("form-check");let r=o.id===a,s=`status-radar-${o.id.toLowerCase().replace(/[^a-z0-9-_]/g,"")||"unk"}`;i.innerHTML=`
                        <input class="form-check-input filter-status" type="radio" name="statusLicitacao" 
                            value="${o.id}" id="${s}" ${r?"checked":""}>
                        <label class="form-check-label" for="${s}">${o.nome}</label>
                    `,T.appendChild(i)});let n=document.createElement("div");n.classList.add("form-check");let l="status-radar-todos";n.innerHTML=`
                    <input class="form-check-input filter-status" type="radio" name="statusLicitacao" value="" id="${l}">
                    <label class="form-check-label" for="${l}">Todos</label>
                `,T.appendChild(n),document.querySelectorAll(".filter-status").forEach(o=>{o.addEventListener("change",Fe)})}else T.innerHTML='<small class="text-danger">Nenhum status encontrado.</small>'}catch(t){console.error("Erro ao carregar status radar:",t),T.innerHTML=`<small class="text-danger">Erro ao carregar status: ${t.message}</small>`}}}function Ne(){M&&(M.innerHTML="",Ae.forEach(t=>{let e=document.createElement("div");e.classList.add("form-check");let a=`uf-${t.sigla.toLowerCase().replace(/[^a-z0-9-_]/g,"")}`;e.innerHTML=`
                <input class="form-check-input filter-uf" type="checkbox" value="${t.sigla}" id="${a}">
                <label class="form-check-label" for="${a}">${t.nome} (${t.sigla})</label>
            `,M.appendChild(e)}),document.querySelectorAll(".filter-uf").forEach(t=>{t.addEventListener("change",ie)}),ne())}async function ie(){ne();let t=Array.from(document.querySelectorAll(".filter-uf:checked")).map(i=>i.value),e=document.getElementById("municipiosContainerDropdown"),a=document.getElementById("dropdownMunicipiosButton"),n=document.getElementById("municipiosHelp");if(!e||!a)return;if(a.disabled=!0,e.innerHTML="",t.length===0){e.innerHTML='<small class="text-muted p-2">Selecione uma UF primeiro</small>',n&&(n.textContent="Selecione uma ou mais UFs para listar os munic\xEDpios."),le();return}a.disabled=!1,e.innerHTML='<div class="p-2 text-muted">Carregando munic\xEDpios...</div>',n&&(n.textContent=`Carregando munic\xEDpios para ${t.join(", ")}...`);let l=[],o=[];for(let i of t)try{let r=await fetch(`/api/ibge/municipios/${i}`),s=await r.json();if(console.log(`Resposta da API para UF ${i}:`,s),!r.ok){o.push(i);continue}s.forEach(d=>{l.push({id:`${i}-${d.id}`,nome:`${d.nome} (${i})`,nomeOriginal:d.nome,uf:i})})}catch(r){console.error(`Erro cr\xEDtico ao carregar munic\xEDpios para ${i}:`,r),o.push(i)}l.sort((i,r)=>i.nome.localeCompare(r.nome)),e.innerHTML="",l.length>0?(l.forEach(i=>{let r=document.createElement("div");r.classList.add("form-check","ms-2");let s=`mun-${i.id.replace(/[^a-zA-Z0-9]/g,"")}`;r.innerHTML=`
                    <input class="form-check-input filter-municipio" type="checkbox" value="${i.nomeOriginal}" id="${s}">
                    <label class="form-check-label" for="${s}">${i.nome}</label>
                `,e.appendChild(r)}),document.querySelectorAll(".filter-municipio").forEach(i=>{i.addEventListener("change",le)}),n&&(n.textContent=`Munic\xEDpios de ${t.join(", ")}. Selecione um ou mais.`)):(e.innerHTML='<small class="text-danger p-2">Nenhum munic\xEDpio encontrado.</small>',n&&(n.textContent="Nenhum munic\xEDpio encontrado para as UFs selecionadas.")),o.length>0&&n&&(n.textContent+=` (Erro ao carregar de: ${o.join(", ")})`),le()}function Fe(t){let e=t.target.value}async function N(t=1){console.log(`[DEBUG] \u{1F4E1} BUSCANDO LICITA\xC7\xD5ES... P\xE1gina: ${t}`),Q();let e=document.getElementById("btnBuscarLicitacoes");e&&(e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Buscando...'),H=t;let a=new URLSearchParams;j&&j.classList.remove("d-none"),h.length>0&&h.forEach(c=>a.append("palavraChave",c)),y.length>0&&y.forEach(c=>a.append("excluirPalavra",c)),document.querySelectorAll(".filter-uf:checked").forEach(c=>a.append("uf",c.value)),document.querySelectorAll(".filter-modalidade:checked").forEach(c=>a.append("modalidadeId",c.value));let n=document.querySelector(".filter-status:checked"),l="";if(n&&(l=n.value),l&&a.append("statusRadar",l),S&&S.classList.add("d-none"),(l===""||l==="Encerrada")&&h.length===0){S&&(S.textContent="Palavra-chave de busca \xE9 obrigat\xF3ria para este status.",S.classList.remove("d-none")),L&&(L.innerHTML='<tr><td colspan="8" class="text-center text-danger">Forne\xE7a uma palavra-chave para buscar com o status selecionado.</td></tr>'),J&&(J.textContent="0"),R&&(R.textContent=""),A&&(A.innerHTML=""),j&&j.classList.add("d-none"),e&&(e.disabled=!1,e.innerHTML='<i class="bi bi-search"></i> Aplicar Filtros');return}let o=Array.from(document.querySelectorAll("#municipiosContainerDropdown .filter-municipio:checked")).map(c=>c.value);o.length>0&&o.forEach(c=>a.append("municipioNome",c));let i=I.value;i&&a.append("dataPubInicio",i);let r=$.value;if(r&&a.append("dataPubFim",r),g&&u){let c=g.value;c&&a.append("dataAtualizacaoInicio",c);let E=u.value;E&&a.append("dataAtualizacaoFim",E)}let s=m.value;s&&a.append("valorMin",s);let d=x.value;d&&a.append("valorMax",d),a.append("pagina",H),a.append("porPagina",V.value);let[k,F]=q.value.split("_");a.append("orderBy",k),a.append("orderDir",F.toUpperCase()),L.innerHTML='<tr><td colspan="8" class="text-center">Buscando licita\xE7\xF5es... <div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>',J.textContent="-",R.textContent="";try{console.log("[DEBUG] \u2699\uFE0F Par\xE2metros da API:",a.toString());let c=await fetch(`/api/frontend/licitacoes?${a.toString()}`);if(!c.ok){let p=await c.json().catch(()=>({}));console.error("Erro da API:",c.status,p);let f=`Erro ${c.status}`;throw c.status===400&&p.erro?f=`Erro de valida\xE7\xE3o: ${p.erro}${p.detalhes?" ("+p.detalhes+")":""}`:c.status===404?f="Recurso n\xE3o encontrado no servidor (404).":p.erro_backend?f=`Erro no servidor: ${p.erro_backend}`:p.erro_frontend?f=`Erro no servidor do frontend: ${p.erro_frontend}`:c.statusText&&(f=`Erro ${c.status}: ${c.statusText}`),new Error(`Erro na API: ${c.status}`)}let E=await c.json();if(console.log("[DEBUG] \u2705 Dados recebidos da API:",E),He(E.licitacoes),Re(E),xe(),J.textContent=E.total_registros||"0",E.licitacoes&&E.licitacoes.length>0){let p=(E.pagina_atual-1)*parseInt(E.por_pagina,10)+1,f=p+E.licitacoes.length-1;R.textContent=`Exibindo ${p}-${f} de ${E.total_registros}`}else R.textContent="Nenhum resultado",(!E.total_registros||E.total_registros===0)&&(L.innerHTML='<tr><td colspan="8" class="text-center">Nenhuma licita\xE7\xE3o encontrada para os filtros aplicados.</td></tr>')}catch(c){console.error("[DEBUG] \u{1F4A5} Erro cr\xEDtico ao buscar licita\xE7\xF5es:",c),L.innerHTML=`<tr><td colspan="8" class="text-center text-danger">Erro ao buscar licita\xE7\xF5es: ${c.message}</td></tr>`,J.textContent="0",R.textContent="Erro",A.innerHTML=""}finally{j&&j.classList.add("d-none"),e&&(e.disabled=!1,e.innerHTML='<i class="bi bi-search"></i> Aplicar Filtros'),console.log("[DEBUG] \u{1F3C1} Fim da busca.")}}function He(t){if(L){if(L.innerHTML="",!t||t.length===0){L.innerHTML='<tr><td colspan="8" class="text-center">Nenhuma licita\xE7\xE3o encontrada para os filtros aplicados.</td></tr>';return}t.forEach(e=>{let a=document.createElement("tr"),n=Ie(e.situacaoReal),l=e.objetoCompra||"N/I",o=l.substring(0,100),i=l;l.length>100&&(i=`<span class="objeto-curto">${o}... <a href="#" class="ver-mais-objeto" data-objeto-completo="${e.id}">Ver mais</a></span>
                            <span class="objeto-completo d-none">${l} <a href="#" class="ver-menos-objeto" data-objeto-completo="${e.id}">Ver menos</a></span>`);let r="N/I";e.valorTotalEstimado===null?r='<span class="text-info fst-italic">Sigiloso</span>':e.valorTotalEstimado!==void 0&&e.valorTotalEstimado!==""&&!isNaN(parseFloat(e.valorTotalEstimado))?r=`R$ ${parseFloat(e.valorTotalEstimado).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`:(typeof e.valorTotalEstimado=="string"&&e.valorTotalEstimado.trim()===""||!e.valorTotalEstimado&&e.valorTotalEstimado!==0)&&(r='<span class="text-info fst-italic">Sigiloso</span>');let s=te(e.numeroControlePNCP),d=`
                <button class="btn btn-sm ${s?"btn-warning active":"btn-outline-warning"} btn-favoritar" 
                        title="${s?"Desfavoritar":"Favoritar"}" data-pncp-id="${e.numeroControlePNCP}">
                    <i class="bi ${s?"bi-star-fill":"bi-star"}"></i>
                </button>
            `;a.innerHTML=`
                <td data-label="Munic\xEDpio/UF" class="align-middle">${e.unidadeOrgaoMunicipioNome||"N/I"}/${e.unidadeOrgaoUfSigla||"N/I"}</td>
                <td data-label="Objeto"><div class="objeto-container" data-lic-id="${e.id}">${i}</div></td>
                <td data-label="\xD3rg\xE3o" class="align-middle">${e.orgaoEntidadeRazaoSocial||"N/I"}</td>
                <td data-label="Status" class="align-middle"><span class="badge ${n}">${e.situacaoReal||e.situacaoCompraNome||"N/I"}</span></td>
                <td data-label="Valor (R$)" class="align-middle">${r}</td>
                <td data-label="Modalidade" class="align-middle">${e.modalidadeNome||"N/I"}</td>
                <td data-label="Atualiza\xE7\xE3o" class="align-middle">${e.dataAtualizacao?new Date(e.dataAtualizacao+"T00:00:00Z").toLocaleDateString("pt-BR"):"N/I"}</td>
                <td data-label="A\xE7\xF5es" class="text-nowrap align-middle">
                    <button class="btn btn-sm btn-info btn-detalhes" title="Mais Detalhes" data-pncp-id="${e.numeroControlePNCP}"><i class="bi bi-eye-fill"></i></button>                                                
                    ${d}
                </td>
            `,L.appendChild(a)}),document.querySelectorAll(".ver-mais-objeto").forEach(e=>{e.addEventListener("click",function(a){a.preventDefault();let n=this.closest(".objeto-container");n.querySelector(".objeto-curto").classList.add("d-none"),n.querySelector(".objeto-completo").classList.remove("d-none")})}),document.querySelectorAll(".ver-menos-objeto").forEach(e=>{e.addEventListener("click",function(a){a.preventDefault();let n=this.closest(".objeto-container");n.querySelector(".objeto-completo").classList.add("d-none"),n.querySelector(".objeto-curto").classList.remove("d-none")})}),document.querySelectorAll(".btn-detalhes").forEach(e=>{e.addEventListener("click",Se)})}}function Ie(t){if(!t)return"bg-secondary";let e=t.toLowerCase();return e.includes("recebendo")||e.includes("aberta")||e.includes("divulgada")?"bg-success":e.includes("encerrada")||e.includes("homologada")||e.includes("conclu\xEDda")?"bg-primary":e.includes("julgamento")?"bg-warning text-dark":e.includes("suspensa")?"bg-info text-dark":e.includes("anulada")||e.includes("revogada")||e.includes("cancelada")?"bg-danger":"bg-secondary"}function Re(t){if(A.innerHTML="",!t||!t.licitacoes||t.total_paginas==null||t.total_paginas<=1)return;let e=parseInt(t.pagina_atual,10),a=parseInt(t.total_paginas,10);if(isNaN(e)||isNaN(a))return;let n=document.createElement("li");n.classList.add("page-item"),e===1&&n.classList.add("disabled"),n.innerHTML=`<a class="page-link" href="#" data-page="${e-1}">Anterior</a>`,A.appendChild(n);let l=Math.max(1,e-2),o=Math.min(a,e+2),i=5;if(o-l+1<i){if(e<i/2)o=Math.min(a,l+i-1);else if(e>a-i/2)l=Math.max(1,o-i+1);else{let s=Math.floor((i-(o-l+1))/2);l=Math.max(1,l-s),o=Math.min(a,o+(i-(o-l+1)-s))}o-l+1>i&&(l===1?o=l+i-1:l=o-i+1)}if(l>1){let s=document.createElement("li");if(s.classList.add("page-item"),s.innerHTML='<a class="page-link" href="#" data-page="1">1</a>',A.appendChild(s),l>2){let d=document.createElement("li");d.classList.add("page-item","disabled"),d.innerHTML='<span class="page-link">...</span>',A.appendChild(d)}}for(let s=l;s<=o;s++){let d=document.createElement("li");d.classList.add("page-item"),s===e&&d.classList.add("active"),d.innerHTML=`<a class="page-link" href="#" data-page="${s}">${s}</a>`,A.appendChild(d)}if(o<a){if(o<a-1){let d=document.createElement("li");d.classList.add("page-item","disabled"),d.innerHTML='<span class="page-link">...</span>',A.appendChild(d)}let s=document.createElement("li");s.classList.add("page-item"),s.innerHTML=`<a class="page-link" href="#" data-page="${a}">${a}</a>`,A.appendChild(s)}let r=document.createElement("li");r.classList.add("page-item"),e===a&&r.classList.add("disabled"),r.innerHTML=`<a class="page-link" href="#" data-page="${e+1}">Pr\xF3xima</a>`,A.appendChild(r),A.querySelectorAll(".page-link").forEach(s=>{s.addEventListener("click",function(d){d.preventDefault();let k=this.closest(".page-item");if(k&&(k.classList.contains("disabled")||k.classList.contains("active")))return;let F=parseInt(this.dataset.page);F&&!isNaN(F)&&N(F)})})}function Ce(){console.log("[DEBUG] \u{1F5D1}\uFE0F INICIANDO LIMPEZA TOTAL DE FILTROS..."),re&&(re.value=""),se&&(se.value=""),console.log("[DEBUG] Limpando arrays de palavras-chave em mem\xF3ria..."),h=[],y=[],w(h,Z,"inclusao"),w(y,W,"exclusao"),document.querySelectorAll("#ufsContainerDropdown .filter-uf:checked").forEach(l=>l.checked=!1),typeof ne=="function"&&ne(),ie(),document.querySelectorAll("#modalidadesContainerDropdown .filter-modalidade:checked").forEach(l=>l.checked=!1),typeof O=="function"&&O();let t=document.querySelectorAll(".filter-status"),e=null,a="A Receber/Recebendo Proposta";if(t.forEach(l=>{l.value===a&&(e=l)}),e)e.checked=!0;else if(t.length>0){let l=Array.from(t).find(o=>o.value!=="");l?l.checked=!0:t.length>0&&(t[0].checked=!0)}S.classList.add("d-none"),I&&(I.value=""),$&&($.value=""),g&&(g.value=""),u&&(u.value=""),m&&(m.value=""),x&&(x.value="");let n=document.getElementById("collapseAdvanced");n&&n.classList.contains("show")&&new bootstrap.Collapse(n).hide(),console.log("[DEBUG] Chamando salvarFiltrosAtuais() ap\xF3s zerar os arrays..."),Q(),console.log("[DEBUG] Limpeza conclu\xEDda. Acionando nova busca..."),xe(),N(1)}let $e=document.getElementById("detailsPanel"),ke=$e?new bootstrap.Offcanvas($e):null,U=document.getElementById("detailsPanelContent");async function Se(t){let e=t.currentTarget.dataset.pncpId;if(!(!e||!ke)){U.innerHTML='<p class="text-center">Carregando detalhes...</p>',document.getElementById("detailsPanelItensTableBody").innerHTML="",document.getElementById("detailsPanelItensPagination").innerHTML="",document.getElementById("detailsPanelArquivosList").innerHTML="",ke.show();try{let a=await fetch(`/api/frontend/licitacao/${encodeURIComponent(e)}`);if(!a.ok){let l=await a.json().catch(()=>({erro_frontend:"Erro desconhecido na resposta da API de detalhes."}));throw new Error(l.erro_backend||l.erro_frontend||`Erro ${a.status}`)}let n=await a.json();console.log("[DEBUG] Dados de DETALHES recebidos para PNCP ID:",e,JSON.parse(JSON.stringify(n))),qe(n)}catch(a){console.error("Erro ao buscar detalhes da licita\xE7\xE3o:",a),U.innerHTML=`<p class="text-center text-danger">Erro ao carregar detalhes: ${a.message}</p>`}}}L&&L.addEventListener("click",function(t){let e=t.target.closest("tr");if(!e||t.target.closest("a, button"))return;let a=L.querySelector(".linha-selecionada");a&&a.classList.remove("linha-selecionada"),e.classList.add("linha-selecionada")});function qe(t){if(!de)return;if(!t||!t.licitacao){U.innerHTML='<p class="text-center text-danger">Dados da licita\xE7\xE3o n\xE3o encontrados.</p>';return}let e=t.licitacao,a=document.getElementById("detailsPanelSubtitle"),n=document.getElementById("detailsPanelLabel"),l=document.getElementById("detailsPanelFavoriteIconContainer");if(l&&(l.innerHTML="",e&&e.numeroControlePNCP)){let p=te(e.numeroControlePNCP),f=document.createElement("button");f.id="detailsPanelFavoriteBtn",f.classList.add("btn","btn-link","text-warning","p-0","btn-favoritar"),f.style.fontSize="1.5rem",f.dataset.pncpId=e.numeroControlePNCP,f.title=p?"Desfavoritar":"Favoritar",f.innerHTML=`<i class="bi ${p?"bi-star-fill":"bi-star"}"></i>`,l.appendChild(f)}let o=`Detalhes: ${e.numeroControlePNCP||"N/I"}`;e.unidadeOrgaoNome?o=e.unidadeOrgaoNome:e.processo&&(o=`Processo: ${e.processo}`),n&&(n.textContent=o),a&&(e.numeroCompra&&e.anoCompra?(a.textContent=`Edital: ${e.numeroCompra}/${e.anoCompra}`,a.style.display="block"):e.numeroCompra?(a.textContent=`N\xFAmero da Compra: ${e.numeroCompra}`,a.style.display="block"):(a.textContent="",a.style.display="none"));let i=p=>p?new Date(p+"T00:00:00Z").toLocaleDateString("pt-BR"):"N/I",r="";e.numeroCompra&&e.anoCompra?r=`<p class="mb-1"><strong>Edital:</strong> ${e.numeroCompra}/${e.anoCompra}</small></p>`:e.numeroCompra&&(r=`<p class="mb-0"><strong>N\xFAmero Compra:</strong> ${e.numeroCompra}</small></p>`);let s=` 
            <p><strong>N\xFAmero PNCP:</strong> ${e.numeroControlePNCP||"N/I"}</p>
            ${e.processo?`<p><strong>N\xFAmero do Processo:</strong> ${e.processo}</p>`:""}     
            <p><strong>Objeto:</strong></p>
            <div class="mb-2" style="white-space: pre-wrap; background-color: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 150px; overflow-y: auto;">${e.objetoCompra||"N/I"}</div>
            <p><strong>\xD3rg\xE3o:</strong> ${e.orgaoEntidadeRazaoSocial||"N/I"}</p>
            <p><strong>Unidade Compradora:</strong> ${e.unidadeOrgaoNome||"N/I"}</p>
            <p><strong>Munic\xEDpio/UF:</strong> ${e.unidadeOrgaoMunicipioNome||"N/I"}/${e.unidadeOrgaoUfSigla||"N/I"}</p>
            <p><strong>Modalidade:</strong> ${e.modalidadeNome||"N/I"}</p>                    
            ${e.amparoLegalNome?`<p><strong>Amparo Legal:</strong> ${e.amparoLegalNome}</p>`:""}
            ${e.valorTotalHomologado?`<p><strong>Valor Total Homologado:</strong> R$ ${parseFloat(e.valorTotalHomologado).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}</p>`:""}
            ${e.modoDisputaNome?`<p><strong>Modo de Disputa:</strong> ${e.modoDisputaNome}</p>`:'<p class="text-muted small"><small><strong>Modo de Disputa:</strong> (N\xE3o informado)</small></p>'}
            ${e.tipolnstrumentoConvocatorioNome?`<p><strong>Tipo:</strong> ${e.tipolnstrumentoConvocatorioNome}</p>`:'<p class="text-muted small"><small><strong>Tipo:</strong> (N\xE3o informado)</small></p>'}
            <p><strong>Situa\xE7\xE3o Atual:</strong> <span class="badge ${Ie(e.situacaoReal)}">${e.situacaoReal||"N/I"}</span></p>                
            <p><strong>Data Publica\xE7\xE3o PNCP:</strong> ${i(e.dataPublicacaoPncp)}</p>                
            <div class="my-2 p-2 border-start border-primary border-3 bg-light-subtle rounded-end">
                <p class="mb-1"><strong>In\xEDcio Recebimento Propostas:</strong> ${he(e.dataAberturaProposta)} (Hor\xE1rio de Bras\xEDlia)</p>
                <p class="mb-0"><strong>Fim Recebimento Propostas:</strong> ${he(e.dataEncerramentoProposta)} (Hor\xE1rio de Bras\xEDlia)</p>
            </div>
            <p><strong>\xDAltima Atualiza\xE7\xE3o:</strong> ${i(e.dataAtualizacao)}</p>            
            <p><strong>Valor Total Estimado:</strong> ${e.valorTotalEstimado===null?'<span class="text-info fst-italic">Sigiloso</span>':e.valorTotalEstimado?`R$ ${parseFloat(e.valorTotalEstimado).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"Sigiloso"}</p>
            <p><strong>Informa\xE7\xE3o Complementar:</strong></p>
            <div style="white-space: pre-wrap; background-color: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 150px; overflow-y: auto;">
                ${e.informacaoComplementar||"Nenhuma"}
            </div>
        `,d="";if(e.justificativaPresencial){let p=e.justificativaPresencial,f=200;p.length>f?d=`
                    <p><strong>Justificativa Presencial:</strong></p>
                    <div class="justificativa-container">
                        <span class="justificativa-curta" style="white-space: pre-wrap;">${p.substring(0,f)}... <a href="#" class="ver-mais-justificativa">Ver mais</a></span>
                        <span class="justificativa-completa d-none" style="white-space: pre-wrap;">${p} <a href="#" class="ver-menos-justificativa">Ver menos</a></span>
                    </div>`:d=`<p><strong>Justificativa Presencial:</strong></p><div style="white-space: pre-wrap;">${p}</div>`}s+=d,U.innerHTML=s;let k=U.querySelector(".ver-mais-justificativa");k&&k.addEventListener("click",function(p){p.preventDefault();let f=this.closest(".justificativa-container");f.querySelector(".justificativa-curta").classList.add("d-none"),f.querySelector(".justificativa-completa").classList.remove("d-none")});let F=U.querySelector(".ver-menos-justificativa");F&&F.addEventListener("click",function(p){p.preventDefault();let f=this.closest(".justificativa-container");f.querySelector(".justificativa-completa").classList.add("d-none"),f.querySelector(".justificativa-curta").classList.remove("d-none")});let c=document.getElementById("detailsPanelBtnPncp");c&&(e.link_portal_pncp&&e.link_portal_pncp.trim()!==""?(c.href=e.link_portal_pncp,c.classList.remove("disabled"),c.removeAttribute("aria-disabled")):(c.href="#",c.classList.add("disabled"),c.setAttribute("aria-disabled","true")));let E=document.getElementById("detailsPanelBtnSistemaOrigem");E&&(e.linkSistemaOrigem&&e.linkSistemaOrigem.trim()!==""?(E.disabled=!1,E.innerHTML='<i class="bi bi-building"></i> Acessar Sistema de Origem',E.onclick=()=>{window.open(e.linkSistemaOrigem,"_blank")}):(E.disabled=!0,E.innerHTML='<i class="bi bi-building"></i> Sistema de Origem (N\xE3o dispon\xEDvel)',E.onclick=null)),je(t.itens||[]),Oe(t.arquivos||[])}let z=[],P=1,pe=5;function je(t){z=t,P=1,ge()}function ge(){let t=document.getElementById("detailsPanelItensTableBody"),e=document.getElementById("detailsPanelItensPagination");if(t.innerHTML="",e.innerHTML="",!z||z.length===0){t.innerHTML='<tr><td colspan="5" class="text-center">Nenhum item encontrado.</td></tr>';return}let a=Math.ceil(z.length/pe),n=(P-1)*pe,l=n+pe;if(z.slice(n,l).forEach(o=>{let i=document.createElement("tr"),r="N/I";o.valorUnitarioEstimado===null?r='<span class="text-info fst-italic">Sigiloso</span>':o.valorUnitarioEstimado!==void 0&&o.valorUnitarioEstimado!==""&&!isNaN(parseFloat(o.valorUnitarioEstimado))&&(r=parseFloat(o.valorUnitarioEstimado).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}));let s="N/I";o.valorTotal===null?s='<span class="text-info fst-italic">Sigiloso</span>':o.valorTotal!==void 0&&o.valorTotal!==""&&!isNaN(parseFloat(o.valorTotal))&&(s=parseFloat(o.valorTotal).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),i.innerHTML=`
                <td data-label="Item">${o.numeroItem||"N/I"}</td>
                <td data-label="Descri\xE7\xE3o">${o.descricao||"N/I"}</td>
                <td data-label="Qtde." class="text-end">${o.quantidade||"N/I"}</td>
                <td data-label="Un." class="text-center">${o.unidadeMedida||"N/I"}</td>
                <td data-label="Vl. Unit." class="text-end">${r}</td>
                <td data-label="Vl. Total" class="text-end">${s}</td>
            `,t.appendChild(i)}),a>1){let o=document.createElement("li");o.classList.add("page-item"),P===1&&o.classList.add("disabled"),o.innerHTML='<a class="page-link page-link-sm" href="#">Ant</a>',o.addEventListener("click",s=>{s.preventDefault(),P>1&&(P--,ge())}),e.appendChild(o);let i=document.createElement("li");i.classList.add("page-item","disabled"),i.innerHTML=`<span class="page-link page-link-sm">${P}/${a}</span>`,e.appendChild(i);let r=document.createElement("li");r.classList.add("page-item"),P===a&&r.classList.add("disabled"),r.innerHTML='<a class="page-link page-link-sm" href="#">Pr\xF3x</a>',r.addEventListener("click",s=>{s.preventDefault(),P<a&&(P++,ge())}),e.appendChild(r)}else if(a===1&&z.length>0){let o=document.createElement("li");o.classList.add("page-item"),o.classList.add("disabled"),o.innerHTML=`<span class="page-link page-link-sm">${P} / ${a}</span>`,e.appendChild(o)}}function Oe(t){let e=document.getElementById("detailsPanelArquivosList");if(e.innerHTML="",!t||t.length===0){let a=document.createElement("li");a.classList.add("list-group-item"),a.textContent="Nenhum arquivo encontrado.",e.appendChild(a);return}t.forEach(a=>{let n=document.createElement("li");n.classList.add("list-group-item"),n.innerHTML=`<a href="${a.link_download}" target="_blank"><i class="bi bi-file-earmark-arrow-down"></i> ${a.titulo||"Arquivo sem t\xEDtulo"}</a>`,e.appendChild(n)})}async function Ue(){console.log("[DEBUG] \u{1F3C1} INICIALIZANDO A P\xC1GINA..."),Ne(),await Pe(),await we(),Me(),me(),N(1),ue("ufSearchInput","ufsContainerDropdown",".form-check"),ue("modalidadeSearchInput","modalidadesContainerDropdown",".form-check"),ue("municipioSearchInput","municipiosContainerDropdown",".form-check"),ye(re,Z,"inclusao"),ye(se,W,"exclusao"),_&&_.addEventListener("click",()=>N(1)),D&&D.addEventListener("click",Ce),q&&q.addEventListener("change",()=>N(H||1)),V&&V.addEventListener("change",()=>N(1));let t=document.getElementById("btnAtualizarTabela");t&&(t.disabled=!1,t.addEventListener("click",()=>{console.log("Bot\xE3o Atualizar Tabela clicado - Refazendo busca para p\xE1gina:",H),H<1&&(H=1),N(H)})),console.log("[DEBUG] \u2705 P\xE1gina inicializada e listeners configurados.")}Ue()}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Carregado. Orquestrador JS iniciado."),De(),document.body.classList.contains("page-busca-licitacoes")&&Te()})})();})();
